---
phase: 42-remove-dead-apis
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ui/components/CombatPanel.vue
  - src/ui/components/GameTable.vue
  - src/ui/App.vue
  - src/rules/actions/rebel-combat.ts
  - src/rules/actions/index.ts
autonomous: true

must_haves:
  truths:
    - "Zero references to useCurrentView or CURRENT_VIEW_KEY anywhere in src/"
    - "Zero references to acknowledgeAnimations, acknowledgeAnimationEvents, or createAcknowledgeAnimationsAction anywhere in src/"
    - "Zero references to truthCombatComplete or truthActiveCombat anywhere in src/"
    - "The acknowledge callback is removed from createAnimationEvents in App.vue"
    - "All existing tests pass with no regressions"
    - "TypeScript compilation no longer has dead-API errors for these 4 symbols"
  artifacts:
    - path: "src/ui/components/CombatPanel.vue"
      provides: "CombatPanel without useCurrentView or truthCombatComplete"
      contains: "useAnimationEvents"
    - path: "src/ui/components/GameTable.vue"
      provides: "GameTable without useCurrentView or truthActiveCombat"
    - path: "src/ui/App.vue"
      provides: "App without acknowledge callback in createAnimationEvents"
      contains: "createAnimationEvents"
    - path: "src/rules/actions/rebel-combat.ts"
      provides: "rebel-combat without createAcknowledgeAnimationsAction"
      contains: "createClearCombatAnimationsAction"
    - path: "src/rules/actions/index.ts"
      provides: "Action index without acknowledgeAnimations import/registration"
  key_links:
    - from: "src/ui/components/CombatPanel.vue"
      to: "boardsmith/ui"
      via: "import"
      pattern: "import.*useAnimationEvents.*from.*boardsmith/ui"
    - from: "src/ui/App.vue"
      to: "boardsmith/ui"
      via: "createAnimationEvents call"
      pattern: "createAnimationEvents\\(\\{\\s*events:"
---

<objective>
Remove all references to BoardSmith v2 theatre view APIs that no longer exist in BoardSmith v3.0. This is pure dead code deletion -- no replacement logic needed.

Purpose: Eliminate TypeScript compilation errors from dead API references and clear the path for Phase 43+ to build the new event-driven architecture on a clean codebase.
Output: Five files cleaned of dead imports, variables, computeds, watchers, and function definitions. Zero references to useCurrentView, acknowledgeAnimations, truthCombatComplete, or truthActiveCombat.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-remove-dead-apis/42-RESEARCH.md
@src/ui/components/CombatPanel.vue
@src/ui/components/GameTable.vue
@src/ui/App.vue
@src/rules/actions/rebel-combat.ts
@src/rules/actions/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove useCurrentView and all dependent code (DELETE-01)</name>
  <files>
    src/ui/components/CombatPanel.vue
    src/ui/components/GameTable.vue
  </files>
  <action>
    In CombatPanel.vue:
    1. Line 4: Change `import { useAnimationEvents, useCurrentView } from 'boardsmith/ui'` to `import { useAnimationEvents } from 'boardsmith/ui'`
    2. Line 161: Delete `const currentView = useCurrentView();`
    3. Lines 162-167: Delete the entire `const truthCombatComplete = computed(...)` block
    4. Line 756: In `computeNextState()`, change `const combatComplete = props.activeCombat?.combatComplete === true || truthCombatComplete.value;` to `const combatComplete = props.activeCombat?.combatComplete === true;` -- the `sawCombatEndEvent` check handles the event-based path
    5. Lines 803-805: Delete the entire `watch(truthCombatComplete, ...)` watcher
    6. Line 1122: In the template v-if, remove `&& !truthCombatComplete` from the condition. Keep all other conditions intact (`!isAllocating && !isSelectingTargets && ...`)

    In GameTable.vue:
    1. Line 6: Remove `, useCurrentView` from the import. Change `import { useBoardInteraction, type UseActionControllerReturn, useAnimationEvents, useCurrentView, GameOverlay } from 'boardsmith/ui'` to `import { useBoardInteraction, type UseActionControllerReturn, useAnimationEvents, GameOverlay } from 'boardsmith/ui'`
    2. Line 492: Delete `const currentView = useCurrentView();`
    3. Lines 529-533: Delete the entire `const truthActiveCombat = computed(...)` block
    4. Line 536: Remove `?? truthActiveCombat.value` from the activeCombat computed. It becomes `return theatreActiveCombat.value ?? null;`

    IMPORTANT: Do NOT touch `clearCombatAnimations` or `createClearCombatAnimationsAction` -- those are live code, not dead APIs.
  </action>
  <verify>
    Run these greps and confirm zero results:
    - `grep -r "useCurrentView" src/`
    - `grep -r "CURRENT_VIEW_KEY" src/`
    - `grep -r "truthCombatComplete" src/`
    - `grep -r "truthActiveCombat" src/`
  </verify>
  <done>
    Zero references to useCurrentView, CURRENT_VIEW_KEY, truthCombatComplete, or truthActiveCombat in src/. Both files still have valid syntax and retain all non-dead-API code.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove acknowledgment protocol (DELETE-02)</name>
  <files>
    src/ui/App.vue
    src/rules/actions/rebel-combat.ts
    src/rules/actions/index.ts
  </files>
  <action>
    In App.vue:
    1. Lines 28-36: Delete the entire `acknowledge: (upToId) => { ... },` property from the `createAnimationEvents({...})` options object. The call should become:
       ```
       const animationEvents = createAnimationEvents({
         events: () => animationEventsFromState.value,
       });
       ```
       (Trailing comma on events is fine, or remove it -- either way valid JS.)

    In rebel-combat.ts:
    1. Lines 1600-1635 (approximately): Delete the entire `createAcknowledgeAnimationsAction()` function. This is the function AFTER `createClearCombatAnimationsAction`. Do NOT delete `createClearCombatAnimationsAction` (lines ~1585-1598) -- that is live code.

    In index.ts:
    1. Line 65: Delete `createAcknowledgeAnimationsAction,` from the import block
    2. Lines 175-176: Delete the comment `// Acknowledge animation events (BoardSmith v2.4 Animation Event System)` and the `game.registerAction(createAcknowledgeAnimationsAction(game));` call

    After all deletions, run the full test suite to confirm no regressions.
  </action>
  <verify>
    Run these greps and confirm zero results:
    - `grep -r "acknowledgeAnimations" src/`
    - `grep -r "acknowledgeAnimationEvents" src/`
    - `grep -r "createAcknowledgeAnimationsAction" src/`

    Run test suite: `npx vitest --run` -- all tests pass.
  </verify>
  <done>
    Zero references to acknowledgeAnimations, acknowledgeAnimationEvents, or createAcknowledgeAnimationsAction anywhere in src/. All existing tests pass. The 4 TypeScript dead-API compilation errors from the research are resolved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Grep verification (all must return zero results):
   - `grep -r "useCurrentView" src/`
   - `grep -r "CURRENT_VIEW_KEY" src/`
   - `grep -r "acknowledgeAnimations" src/`
   - `grep -r "acknowledgeAnimationEvents" src/`
   - `grep -r "createAcknowledgeAnimationsAction" src/`
   - `grep -r "truthCombatComplete" src/`
   - `grep -r "truthActiveCombat" src/`

2. Test suite: `npx vitest --run` -- all tests pass

3. Confirm `createClearCombatAnimationsAction` is still present and exported (sanity check):
   - `grep -r "createClearCombatAnimationsAction" src/` -- should return hits in rebel-combat.ts and index.ts
</verification>

<success_criteria>
- Zero references to all 7 dead API symbols listed in verification
- All existing tests pass (no regressions)
- createClearCombatAnimationsAction still intact (not accidentally deleted)
- Requirements DELETE-01 and DELETE-02 fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/42-remove-dead-apis/42-01-SUMMARY.md`
</output>
