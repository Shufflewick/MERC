---
phase: 03-code-quality-helpers
plan: 02
type: execute
---

<objective>
Replace duplicate helper patterns in rebel-economy.ts with shared utilities.

Purpose: Remove duplicated code by using helpers from helpers.ts, reducing maintenance burden.
Output: rebel-economy.ts using isDictatorCard, getUnitName, cache helpers, and findUnitSector.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-code-quality-helpers/03-01-SUMMARY.md
@src/rules/actions/helpers.ts
@src/rules/actions/rebel-economy.ts

**Duplicate patterns to replace in rebel-economy.ts:**
1. Lines 325-327: isDictatorCardUnit → use isDictatorCard
2. Lines 330-335: getUnitNameForExplore → use getUnitName
3. Lines 338-370: findUnitSectorForExplore → use findUnitSector
4. Lines 601-603: isDictatorCardForCollect → use isDictatorCard
5. Lines 606-611: getUnitNameForCollect → use getUnitName
6. Lines 742-745: getUnitName (local) → use getUnitName from helpers
7. Lines 882-884: isDictatorCardForTrain → use isDictatorCard
8. Lines 887-892: getUnitNameForTrain → use getUnitName
9. Lines 895-927: findUnitSectorForTrain → use findUnitSector
10. Lines 37-52: getHireDrawnMercIds/set/clear → use cache helpers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace isDictatorCard duplicates and update imports</name>
  <files>src/rules/actions/rebel-economy.ts</files>
  <action>
1. Update imports at top of file to add new helpers:
   - Add to existing helpers import: isDictatorCard, getUnitName, findUnitSector, getCachedValue, setCachedValue, clearCachedValue

2. Remove these local function definitions (they will be replaced by helper calls):
   - isDictatorCardUnit (around line 325-327)
   - isDictatorCardForCollect (around line 601-603)
   - isDictatorCardForTrain (around line 882-884)

3. Update all usages of these local functions to use `isDictatorCard` from helpers:
   - Search for `isDictatorCardUnit(` and replace with `isDictatorCard(`
   - Search for `isDictatorCardForCollect(` and replace with `isDictatorCard(`
   - Search for `isDictatorCardForTrain(` and replace with `isDictatorCard(`

Note: The type narrowing will still work because isDictatorCard returns `unit is DictatorCard`.
  </action>
  <verify>TypeScript compiles: cd /Users/jtsmith/Dropbox/MERC/BoardSmith/MERC && npx tsc --noEmit</verify>
  <done>All isDictatorCard* functions removed, using shared isDictatorCard helper</done>
</task>

<task type="auto">
  <name>Task 2: Replace getUnitName and findUnitSector duplicates</name>
  <files>src/rules/actions/rebel-economy.ts</files>
  <action>
1. Remove these local function definitions:
   - getUnitNameForExplore (around line 330-335)
   - getUnitNameForCollect (around line 606-611)
   - getUnitName local function in takeFromStash (around line 742-745)
   - getUnitNameForTrain (around line 887-892)
   - findUnitSectorForExplore (around line 338-370)
   - findUnitSectorForTrain (around line 895-927)

2. Update all usages to use helpers:
   - Replace `getUnitNameForExplore(unit)` with `getUnitName(unit)`
   - Replace `getUnitNameForCollect(unit)` with `getUnitName(unit)`
   - Replace `getUnitNameForTrain(unit)` with `getUnitName(unit)`
   - Replace `findUnitSectorForExplore(unit, player, game)` with `findUnitSector(unit, player, game)`
   - Replace `findUnitSectorForTrain(unit, player, game)` with `findUnitSector(unit, player, game)`

3. For the local getUnitName in takeFromStash, either:
   - Use the helper directly, OR
   - If the local version has slightly different logic, keep it but rename to avoid confusion
  </action>
  <verify>TypeScript compiles: cd /Users/jtsmith/Dropbox/MERC/BoardSmith/MERC && npx tsc --noEmit</verify>
  <done>All getUnitName* and findUnitSector* functions removed, using shared helpers</done>
</task>

<task type="auto">
  <name>Task 3: Replace cache helper duplicates</name>
  <files>src/rules/actions/rebel-economy.ts</files>
  <action>
1. Remove these local function definitions (around lines 37-52):
   - getHireDrawnMercIds
   - setHireDrawnMercIds
   - clearHireDrawnMercIds

2. Keep the constant: `const HIRE_DRAWN_MERCS_KEY = 'hireDrawnMercs';`

3. Update all usages to use generic cache helpers:
   - Replace `getHireDrawnMercIds(game, playerId)` with `getCachedValue<number[]>(game, HIRE_DRAWN_MERCS_KEY, playerId)`
   - Replace `setHireDrawnMercIds(game, playerId, mercIds)` with `setCachedValue(game, HIRE_DRAWN_MERCS_KEY, playerId, mercIds)`
   - Replace `clearHireDrawnMercIds(game, playerId)` with `clearCachedValue(game, HIRE_DRAWN_MERCS_KEY, playerId)`

This pattern provides type safety via the generic parameter while eliminating boilerplate.
  </action>
  <verify>TypeScript compiles: cd /Users/jtsmith/Dropbox/MERC/BoardSmith/MERC && npx tsc --noEmit</verify>
  <done>Cache helper functions removed, using generic getCachedValue/setCachedValue/clearCachedValue</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] No local isDictatorCard*, getUnitName*, findUnitSector*, or cache helper functions remain
- [ ] All functionality preserved (same behavior, just using shared helpers)
- [ ] Imports updated to include new helpers
</verification>

<success_criteria>

- All 3 tasks completed
- All verification checks pass
- rebel-economy.ts reduced by ~100 lines of duplicate code
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-code-quality-helpers/03-02-SUMMARY.md`
</output>
