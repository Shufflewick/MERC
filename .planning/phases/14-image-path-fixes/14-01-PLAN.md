---
phase: 14-image-path-fixes
plan: 01
type: execute
---

<objective>
Fix hardcoded `.jpg` extensions in UI components that break dictator image display.

Purpose: After v1.2 merge, dictators use `.png` images but UI fallback paths still hardcode `.jpg`, causing broken images when the `image` property is not provided.
Output: All combatant images display correctly for both mercs (`.jpg`) and dictators (`.png`).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./14-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**The bug:**
- Merc images are `.jpg` in `/public/mercs/`
- Dictator images are `.png` in `/public/dictators/`
- `combatants.json` has correct `image` paths for all combatants
- UI components fallback to building paths from IDs, hardcoding `.jpg` even for dictators

**Files with bugs:**
@src/ui/components/MercIconSmall.vue
@src/ui/components/DictatorPanel.vue
@src/ui/components/SectorPanel.vue

**Reference - correct image paths from data:**
- Mercs: `/mercs/apeiron.jpg`, `/mercs/badger.jpg`, etc.
- Dictators: `/dictators/castro.png`, `/dictators/kim.png`, etc.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix MercIconSmall and DictatorPanel extensions</name>
  <files>src/ui/components/MercIconSmall.vue, src/ui/components/DictatorPanel.vue</files>
  <action>
Fix hardcoded `.jpg` extensions when building fallback paths:

**MercIconSmall.vue:**
- Line 31: Change from `.jpg` to `.png` when `isDictator` is true
  - Current: `return \`/${folder}/${props.mercId.toLowerCase()}.jpg\`;`
  - Fix: Use ternary to select extension: `const ext = props.isDictator ? 'png' : 'jpg';`
- Line 34: Change `/dictators/unknown.jpg` to `/dictators/unknown.png`
- Line 38 (fallbackPath): Change `/dictators/unknown.jpg` to `/dictators/unknown.png`

**DictatorPanel.vue:**
- Line 102: Change `.jpg` to `.png`
  - Current: `return \`/dictators/${props.dictator.dictatorId}.jpg\`;`
  - Fix: `return \`/dictators/${props.dictator.dictatorId}.png\`;`
  </action>
  <verify>
Run dev server (`npm run dev`) and visually inspect:
- Dictator selection screen shows dictator portraits (not broken images)
- DictatorPanel shows dictator portrait correctly
- MercIconSmall displays dictator icons when used with isDictator=true
  </verify>
  <done>MercIconSmall and DictatorPanel use `.png` for dictator images, `.jpg` for merc images</done>
</task>

<task type="auto">
  <name>Task 2: Fix SectorPanel getMercImagePath function</name>
  <files>src/ui/components/SectorPanel.vue</files>
  <action>
Fix `getMercImagePath` function (lines 254-284) to detect dictators and use correct folder/extension:

Current logic:
1. Checks for `image` property (correct - uses data value)
2. Checks for `mercId` (returns `/mercs/${mercId}.jpg` - wrong for dictators)
3. Checks for `dictatorId` (but still returns `/mercs/${mercId}.jpg`)
4. Fallback returns `/mercs/unknown.jpg` (wrong for dictators)

Fix:
1. Keep existing `image` property check (line 256-257)
2. After extracting mercId, check if it came from `dictatorId`:
   - Track whether this is a dictator with a boolean
   - Use `/dictators/` folder and `.png` for dictators
   - Use `/mercs/` folder and `.jpg` for mercs
3. Update fallback to return correct unknown path based on whether dictator was detected

Implementation:
```typescript
function getMercImagePath(merc: any): string {
  const image = getAttr(merc, 'image', '');
  if (image) return image;

  // Check for dictator first
  let isDictator = false;
  let id = getAttr(merc, 'dictatorId', '');
  if (!id && merc?.attributes?.dictatorId) {
    id = merc.attributes.dictatorId;
  }
  if (id) {
    isDictator = true;
  } else {
    // Check for mercId
    id = getAttr(merc, 'mercId', '');
    if (!id && merc?.attributes?.mercId) {
      id = merc.attributes.mercId;
    }
  }

  if (id) {
    const folder = isDictator ? 'dictators' : 'mercs';
    const ext = isDictator ? 'png' : 'jpg';
    return `/${folder}/${id}.${ext}`;
  }

  // Fallback - try to derive from name (assume merc if unknown)
  const name = getMercName(merc);
  if (name && name !== 'Unknown') {
    return `/mercs/${name.toLowerCase()}.jpg`;
  }

  return '/mercs/unknown.jpg';
}
```
  </action>
  <verify>
In SectorPanel, verify dictator units display correctly:
- When dictator is in a sector, their portrait shows (not broken)
- When merc is in a sector, their portrait shows (not broken)
- Build passes: `npm run build`
  </verify>
  <done>SectorPanel getMercImagePath uses correct folder and extension based on combatant type</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Dictator portraits display in DictatorPanel
- [ ] Dictator icons display in MercIconSmall when isDictator=true
- [ ] Dictator units in sectors display correct portraits
- [ ] Merc images still display correctly (no regression)
</verification>

<success_criteria>

- All hardcoded `.jpg` paths for dictators changed to `.png`
- Dictator detection logic added to SectorPanel
- No broken images in UI when combatants lack explicit `image` property
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-image-path-fixes/14-01-SUMMARY.md`:

# Phase 14 Plan 01: Image Path Fixes Summary

**[One-liner summary of what shipped]**

## Accomplishments

- Fixed MercIconSmall dictator extension
- Fixed DictatorPanel extension
- Fixed SectorPanel getMercImagePath to detect dictators

## Files Modified

- `src/ui/components/MercIconSmall.vue` - Use .png for dictators
- `src/ui/components/DictatorPanel.vue` - Use .png extension
- `src/ui/components/SectorPanel.vue` - Detect dictator in getMercImagePath

## Decisions Made

None - straightforward bug fix.

## Issues Encountered

[Any problems and resolutions, or "None"]

## Next Step

Phase 14 complete, ready for Phase 15 (Rename to Combatant).
</output>
