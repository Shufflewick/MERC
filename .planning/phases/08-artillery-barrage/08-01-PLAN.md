---
phase: 08-artillery-barrage
plan: 01
type: execute
---

<objective>
Add game state types for pending artillery allocation.

Purpose: Establish the data structure that enables rebels to choose how artillery damage is allocated during dictator's turn.
Output: New `pendingArtilleryAllocation` state property in MERCGame with proper TypeScript types.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./08-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/rules/game.ts

**Existing pattern to follow:**
The game already has `pendingHitAllocation` for combat hit allocation (lines 475-493 of game.ts).
This state structure enables flow interrupts during combat. Artillery needs similar structure.

**Artillery Barrage context:**
- Currently in `src/rules/tactics-effects.ts` lines 39-98
- Attacks sectors adjacent to dictator-controlled sectors
- Rolls d6 per sector, deals that many hits
- Currently auto-applies: militia first, then MERCs
- Need to pause for each sector and let rebels allocate hits
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pendingArtilleryAllocation type to game state</name>
  <files>src/rules/game.ts</files>
  <action>
Add a new property `pendingArtilleryAllocation` to MERCGame class, near `pendingHitAllocation` (around line 507).

Structure should include:
```typescript
pendingArtilleryAllocation: {
  sectorId: string;        // Which sector is being attacked
  sectorName: string;      // For display
  hits: number;            // Total hits to allocate
  allocatedHits: number;   // Hits allocated so far
  validTargets: Array<{
    id: string;            // Target identifier
    name: string;          // Display name
    type: 'militia' | 'merc';
    ownerId: string;       // Which rebel owns this target
    currentHealth: number; // For MERCs
    maxHealth: number;     // For MERCs
  }>;
  sectorsRemaining: Array<{  // Queue of sectors still to process
    sectorId: string;
    sectorName: string;
    hits: number;
  }>;
} | null = null;
```

Initialize to null. This mirrors the pattern used by pendingHitAllocation.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>MERCGame has pendingArtilleryAllocation property with proper typing, compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add helper to check if artillery allocation is pending</name>
  <files>src/rules/game.ts</files>
  <action>
Add a simple getter method to MERCGame class (near other state check methods):

```typescript
/** Check if artillery allocation is pending (rebels need to allocate hits) */
get hasArtilleryPending(): boolean {
  return this.pendingArtilleryAllocation !== null;
}
```

This provides a clean API for flow.ts to check the state without accessing the property directly.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>hasArtilleryPending getter added, compiles without errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes (no regressions)
- [ ] pendingArtilleryAllocation property exists on MERCGame
- [ ] hasArtilleryPending getter works
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- No test regressions
- Game state structure ready for use by flow and tactics-effects
</success_criteria>

<output>
After completion, create `.planning/phases/08-artillery-barrage/08-01-SUMMARY.md`
</output>
