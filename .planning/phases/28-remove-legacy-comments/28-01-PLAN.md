---
phase: 28-remove-legacy-comments
plan: 01
type: execute
---

<objective>
Clean up backward-compat and legacy comments from v1.5 refactors.

Purpose: Remove migration artifacts that no longer serve a purpose after completing the CombatantModel unification.
Output: Clean codebase with no misleading "legacy" or "backward compat" comments, removed deprecated functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior work:** v1.5 completed CombatantModel unification, removed MercCard/DictatorCard subclasses, unified on combatantId/combatantName identity properties. Legacy comments were left as migration markers.

**Files with legacy comments (from grep):**
- src/rules/game.ts (4 legacy comments, 2 type aliases)
- src/rules/actions/rebel-economy.ts (3 legacy helper comments)
- src/rules/combat.ts (2 @deprecated functions)
- src/rules/ai-action-helpers.ts (1 @deprecated function, exported via ai-helpers.ts)
- src/ui/components/*.vue (multiple backward compat comments)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy comments and type aliases from rules layer</name>
  <files>src/rules/game.ts, src/rules/actions/rebel-economy.ts, src/rules/combat.ts, src/rules/ai-action-helpers.ts, src/rules/ai-helpers.ts</files>
  <action>
1. **src/rules/game.ts:**
   - Remove `mercSquad?: Squad; // Legacy for backward compatibility` property (line 167)
   - Remove `mercSquadRef` assignment and `mercSquad` assignment (lines 781-782)
   - Remove `// Legacy type aliases for backward compatibility during migration` comment and the `RebelPlayer`/`DictatorPlayer` type alias exports (lines 345-347)
   - Remove `// Legacy method for array-based loading` comment (line 920) - keep the method itself as it's a valid API
   - Update any exports that reference `RebelPlayer` or `DictatorPlayer`

2. **src/rules/actions/rebel-economy.ts:**
   - Remove `// Legacy helpers for backward compatibility` comment headers (lines 310, 759, 939)
   - Remove the legacy wrapper functions `findMercSectorForExplore`, `isMercOwnedForExplore`, `canMercExplore` (unused - they just wrap the Unit versions)
   - Remove the legacy wrapper functions `findMercSectorForTrain`, `canMercTrain`, `isMercOwnedForTrain` (unused)
   - Remove `getPlayerMercsForCity`, `isMercOwnedForCity` (unused)

3. **src/rules/combat.ts:**
   - Remove `isBadger()` and `isKastern()` functions and their @deprecated comments (lines 118-131) - they're unused

4. **src/rules/ai-action-helpers.ts + ai-helpers.ts:**
   - Remove `getAIMercActionPriority()` function and its @deprecated comment (lines 223-233)
   - Remove the export of `getAIMercActionPriority` from src/rules/ai-helpers.ts (line 50)

**Verification approach:** Check for any usages before removing. If a function IS used, rename instead of removing.
  </action>
  <verify>npm run build passes, npm test passes, grep for removed identifiers returns empty</verify>
  <done>No "Legacy" or "@deprecated" comments remain in rules layer, all deprecated functions removed, type aliases removed</done>
</task>

<task type="auto">
  <name>Task 2: Clean up backward compat comments in UI layer</name>
  <files>src/ui/components/CombatPanel.vue, src/ui/components/SectorTile.vue, src/ui/components/SquadPanel.vue, src/ui/components/GameBoard.vue, src/ui/components/SectorPanel.vue</files>
  <action>
For each file, remove `// backward compat` comments but KEEP the fallback logic (as the UI still needs to handle both old and new data formats for saved games):

1. **src/ui/components/CombatPanel.vue (line 333):**
   - Remove `// backward compat` comment, keep the fallback: `mercId: combatant.combatantId || combatant.mercId`

2. **src/ui/components/SectorTile.vue (lines 24-26):**
   - Remove `// Backward compat aliases (deprecated)` comment from interface
   - Keep the optional `mercId?` and `mercName?` properties (needed for saved game compat)

3. **src/ui/components/SquadPanel.vue (lines 9-10):**
   - Remove `// backward compat` comments from interface properties
   - Keep the optional properties

4. **src/ui/components/GameBoard.vue (lines 632, 666, 687-688, 978, 1027, 1756):**
   - Remove all `// backward compat` and `// Legacy alias for compatibility` comments
   - Keep the fallback logic and alias properties (needed for saved game compat)

5. **src/ui/components/SectorPanel.vue (line 429):**
   - Remove `// (legacy - kept for reference)` comment if present

**Note:** We keep the fallback logic because these components consume serialized game data which may come from saved games that predate the combatantId unification.
  </action>
  <verify>npm run build passes, grep for "backward compat" in src/ui returns empty</verify>
  <done>No "backward compat" or "legacy" comments remain in UI layer, fallback logic preserved for saved game compatibility</done>
</task>

<task type="auto">
  <name>Task 3: Verify and update exports</name>
  <files>src/rules/index.ts, src/rules/actions/index.ts</files>
  <action>
1. Check if `RebelPlayer` or `DictatorPlayer` types are exported from index.ts files
2. If exported, remove those exports
3. Search codebase for any imports of removed identifiers
4. Run full test suite to verify nothing broke

Verify no remaining references to removed items:
- `RebelPlayer` type
- `DictatorPlayer` type
- `mercSquad` property
- `getAIMercActionPriority` function
- `isBadger` / `isKastern` functions
- Legacy helper functions from rebel-economy.ts
  </action>
  <verify>npm run build && npm test - both pass with no errors</verify>
  <done>All exports updated, no dangling references to removed code, full test suite passes</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] `grep -r "Legacy" src/rules/` returns no legacy comments (only legitimate uses)
- [ ] `grep -r "backward compat" src/` returns empty
- [ ] `grep -r "@deprecated" src/` returns empty
- [ ] No TypeScript errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No legacy/backward-compat comments remain as migration markers
- All deprecated functions removed
- Fallback logic preserved in UI for saved game compatibility
- No regressions in tests
</success_criteria>

<output>
After completion, create `.planning/phases/28-remove-legacy-comments/28-01-SUMMARY.md`:

# Phase 28 Plan 01: Remove Legacy Comments Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 29: Rules Layer ID Cleanup
</output>
