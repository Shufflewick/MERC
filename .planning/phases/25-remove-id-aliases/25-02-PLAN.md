---
phase: 25-remove-id-aliases
plan: 02
type: execute
---

<objective>
Replace mercId/mercName/dictatorId/dictatorName/unitId/unitName with combatantId/combatantName in rules layer.

Purpose: Update all rules code to use canonical combatantId/combatantName properties.
Output: All rules/*.ts files use combatantId/combatantName instead of alias properties.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary-frontmatter.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-remove-id-aliases/25-01-SUMMARY.md

**Depends on:** Plan 25-01 (backward-compat getters in place)

**Scope:** 324 occurrences across 21 files in src/rules/

**Replacement patterns:**
- `.mercId` → `.combatantId`
- `.mercName` → `.combatantName`
- `.dictatorId` → `.combatantId`
- `.dictatorName` → `.combatantName`
- `.unitId` → `.combatantId`
- `.unitName` → `.combatantName`

**Files to update (by occurrence count):**
- elements.ts: 51 (includes type interface references)
- combat.ts: 50
- day-one-actions.ts: 48
- rebel-equipment.ts: 41
- rebel-combat.ts: 18
- rebel-economy.ts: 17
- helpers.ts: 15
- rebel-movement.ts: 13
- day-one.ts: 12
- dictator-actions.ts: 10
- dictator-abilities.ts: 9
- actions/index.ts: 8
- game.ts: 6 (remaining after Plan 01)
- ai-helpers.ts: 6
- tactics-effects.ts: 6
- flow.ts: 4
- ai-executor.ts: 3
- setup.ts: 3 (remaining after Plan 01)
- combat-retreat.ts: 2
- ai-combat-helpers.ts: 1
- ai-action-helpers.ts: 1

**Special cases:**
- Interface types (CombatResult.mercId) need updating
- String literals like `'mercId'` in property access
- Comments referencing the old names
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update combat types and core combat code</name>
  <files>src/rules/combat-types.ts, src/rules/combat.ts, src/rules/combat-retreat.ts</files>
  <action>
In combat-types.ts:
- Change `mercId?: string` to `combatantId?: string` in CombatResult interface
- Update any other type references

In combat.ts (50 occurrences):
- Replace all `.mercId` with `.combatantId`
- Replace all `.mercName` with `.combatantName`
- Replace all `.dictatorId` with `.combatantId`
- Replace all `.dictatorName` with `.combatantName`
- Update `mercId:` object property assignments to `combatantId:`

In combat-retreat.ts:
- Replace all alias property usages with canonical names

Use find-and-replace within files. Be careful with:
- `mercId:` (object property key) vs `.mercId` (property access)
- Comments that explain the property
  </action>
  <verify>`npm run build` passes</verify>
  <done>Combat system uses combatantId/combatantName exclusively</done>
</task>

<task type="auto">
  <name>Task 2: Update action files (rebel actions)</name>
  <files>src/rules/actions/rebel-combat.ts, src/rules/actions/rebel-economy.ts, src/rules/actions/rebel-equipment.ts, src/rules/actions/rebel-movement.ts</files>
  <action>
In each file, replace all occurrences:
- `.mercId` → `.combatantId`
- `.mercName` → `.combatantName`
- `.dictatorId` → `.combatantId`
- `.dictatorName` → `.combatantName`
- `.unitId` → `.combatantId`
- `.unitName` → `.combatantName`

Also update object literal keys:
- `mercId:` → `combatantId:`
- `mercName:` → `combatantName:`

Preserve the meaning - combatantId is used for both mercs and dictators.
  </action>
  <verify>`npm run build` passes</verify>
  <done>All rebel action files use combatantId/combatantName</done>
</task>

<task type="auto">
  <name>Task 3: Update remaining action and rule files</name>
  <files>src/rules/actions/day-one-actions.ts, src/rules/actions/dictator-actions.ts, src/rules/actions/helpers.ts, src/rules/actions/index.ts, src/rules/day-one.ts, src/rules/dictator-abilities.ts, src/rules/tactics-effects.ts, src/rules/flow.ts, src/rules/game.ts, src/rules/setup.ts, src/rules/ai-executor.ts, src/rules/ai-helpers.ts, src/rules/ai-action-helpers.ts, src/rules/ai-combat-helpers.ts, src/rules/elements.ts</files>
  <action>
For all remaining files in src/rules/, replace:
- `.mercId` → `.combatantId`
- `.mercName` → `.combatantName`
- `.dictatorId` → `.combatantId`
- `.dictatorName` → `.combatantName`
- `.unitId` → `.combatantId`
- `.unitName` → `.combatantName`

Also update:
- Object property keys (`mercId:` → `combatantId:`)
- Type annotations referencing old property names
- The helpers.ts type that uses mercId in return type

In elements.ts:
- Update `updateHaargBonus`, `updateSargeBonus`, etc. that check `this.unitId`
- Change to `this.combatantId` since unitId is an alias
  </action>
  <verify>
1. `npm run build` passes
2. `npm test` passes
  </verify>
  <done>All rules layer files use combatantId/combatantName exclusively</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] `grep -r "\.mercId\|\.mercName\|\.dictatorId\|\.dictatorName\|\.unitId\|\.unitName" src/rules/` returns only the backward-compat getter definitions in elements.ts
</verification>

<success_criteria>
- All rules/*.ts files use combatantId/combatantName
- No usages of .mercId, .mercName, .dictatorId, .dictatorName, .unitId, .unitName except:
  - Backward-compat getter definitions in elements.ts (to be removed in Plan 04)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/25-remove-id-aliases/25-02-SUMMARY.md`
</output>
