---
phase: 22-reference-updates
plan: 01
type: execute
---

<objective>
Verify that reference updates are complete and close phase with no code changes.

Purpose: Phase 22 was designed to update JSON data files, type guards, and remaining references.
However, analysis shows all code work was completed in Phases 20-21, and remaining 'MercCard'/'DictatorCard'
strings are BoardSmith classRegistry keys that MUST match the TypeScript class names.

Output: Verification report confirming no code changes needed, phase closed as complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-model-renaming/20-03-SUMMARY.md
@.planning/phases/21-vue-component-renaming/21-01-SUMMARY.md
@src/rules/elements.ts
@src/rules/index.ts

**Context:**

The v1.4 milestone intended to unify combatant naming:
- Phase 20: Renamed base classes (CombatUnit → CombatantBase, CombatUnitCard → CombatantModel) ✅
- Phase 21: Renamed Vue component (MercCard.vue → CombatantCard.vue) ✅
- Phase 22: Update remaining references (this phase)
- Phase 23: Documentation

**Analysis findings:**

1. **JSON data files** - Already correct. `combatants.json` uses `cardType: "merc" | "dictator"` discriminator.

2. **Type guards** - Already correct. `isCombatantModel` is the primary function, `isCombatUnitCard` is a backward-compat alias.

3. **'MercCard'/'DictatorCard' strings in UI** - These are BoardSmith classRegistry keys that MUST match the TypeScript class names. They CANNOT be renamed without breaking serialization. The TypeScript model classes `MercCard` and `DictatorCard` are thin wrappers extending `CombatantModel` - their names are intentional.

4. **Backward-compat aliases** - Already in place at `src/rules/index.ts`:
   - `CombatantBase as CombatUnit`
   - `CombatantModel as CombatUnitCard`

**Conclusion:** No code changes required for Phase 22.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify JSON data file structure</name>
  <files>data/combatants.json</files>
  <action>
    Confirm combatants.json uses cardType discriminator correctly.
    Run: `head -30 data/combatants.json` to verify structure.
    Expected: Each entry has `"cardType": "merc"` or `"cardType": "dictator"`.
  </action>
  <verify>grep -c '"cardType": "merc"' data/combatants.json returns count > 40 (mercs); grep -c '"cardType": "dictator"' data/combatants.json returns count >= 2 (dictators)</verify>
  <done>JSON data files confirmed correct - no changes needed</done>
</task>

<task type="auto">
  <name>Task 2: Verify type guards are correct</name>
  <files>src/rules/actions/helpers.ts</files>
  <action>
    Confirm isCombatantModel is the primary type guard with isCombatUnitCard as backward-compat alias.
    Run: `grep -n "isCombatantModel\|isCombatUnitCard" src/rules/actions/helpers.ts`
    Expected: isCombatantModel defined first, isCombatUnitCard = isCombatantModel alias.
  </action>
  <verify>grep shows isCombatantModel function and isCombatUnitCard alias</verify>
  <done>Type guards confirmed correct - no changes needed</done>
</task>

<task type="auto">
  <name>Task 3: Verify backward-compat exports</name>
  <files>src/rules/index.ts</files>
  <action>
    Confirm backward-compat aliases are exported from rules/index.ts.
    Run: `grep -n "CombatUnit\|CombatUnitCard" src/rules/index.ts`
    Expected: Re-export aliases for CombatUnit, CombatUnitCard.
  </action>
  <verify>grep shows backward-compat re-exports</verify>
  <done>Backward-compat exports confirmed - no changes needed</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] JSON data files use cardType discriminator
- [ ] Type guards correctly named (isCombatantModel primary)
- [ ] Backward-compat exports in place
</verification>

<success_criteria>

- All verification checks pass
- No code changes made (as expected)
- Documentation of findings for Phase 23
</success_criteria>

<output>
After completion, create `.planning/phases/22-reference-updates/22-01-SUMMARY.md`:

# Phase 22 Plan 01: Verify Reference Updates Summary

**Verified that all reference updates were completed in prior phases - no code changes required**

## Accomplishments

- Verified JSON data files correctly use cardType discriminator
- Verified type guards correctly named (isCombatantModel)
- Verified backward-compat exports in place
- Documented that 'MercCard'/'DictatorCard' className strings must remain for BoardSmith serialization

## Files Created/Modified

None - verification only

## Decisions Made

- 'MercCard'/'DictatorCard' className strings in UI are BoardSmith classRegistry keys that must match TypeScript class names
- No code changes needed - Phase 22 scope was already addressed by Phases 20-21

## Issues Encountered

None

## Next Phase Readiness

- Phase 22 complete
- Ready for Phase 23 (Documentation)
- Documentation should update .planning/codebase/ARCHITECTURE.md to reflect new class names
</output>
