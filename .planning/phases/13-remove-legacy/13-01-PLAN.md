---
phase: 13-remove-legacy
plan: 01
type: execute
---

<objective>
Remove legacy data files and fix remaining references to the old separate data structures.

Purpose: Complete the data unification by removing mercs.json/dictators.json and updating code that still references the old separate data properties.
Output: Clean codebase with single combatants.json, no broken references, all tests/build pass.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./13-01-summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (from frontmatter)
@.planning/phases/12-merge-data-files/12-01-SUMMARY.md

# Key files for this phase
@src/rules/game.ts
@src/rules/actions/day-one-actions.ts
@src/ui/components/GameBoard.vue
@data/mercs.json
@data/dictators.json

**Tech stack available:** cardType discriminator, combatantData unified array, isMerc/isDictator properties
**Established patterns:** Filter combatantData for merc/dictator entries as needed
**Constraining decisions:**
- Phase 12: combatantData is single source of truth, old mercData/dictatorData getters removed
- Phase 12: Settings now stores combatantData not separate mercData/dictatorData
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix day-one-actions.ts dictatorData references</name>
  <files>src/rules/actions/day-one-actions.ts</files>
  <action>
The `createSelectDictatorAction` function references `game.dictatorData` which was removed in Phase 12.

1. Find all references to `game.dictatorData` in day-one-actions.ts
2. Replace with filtered combatantData:
   - `const dictators = game.combatantData.filter(d => d.cardType === 'dictator');`
3. Update the choice mapping to use the filtered array
4. Update the execute handler to use the filtered array

The code around lines 575-590 needs updating:
```typescript
// OLD:
const dictators = game.dictatorData || [];

// NEW:
const dictators = game.combatantData.filter(d => d.cardType === 'dictator');
```

And around lines 584-590:
```typescript
// OLD:
const dictatorData = game.dictatorData;
const dictator = dictatorData.find(d => d.name === dictatorName);

// NEW:
const dictatorData = game.combatantData.filter(d => d.cardType === 'dictator');
const dictator = dictatorData.find(d => d.name === dictatorName);
```
  </action>
  <verify>
- `npm run build` succeeds
- No TypeScript errors about dictatorData property
  </verify>
  <done>
- All references to game.dictatorData replaced with filtered combatantData
- Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix GameBoard.vue dictatorData references</name>
  <files>src/ui/components/GameBoard.vue</files>
  <action>
The UI code reads `settings.dictatorData` which no longer exists - it's now `settings.combatantData`.

1. Find the dictator selection code around lines 1799-1801
2. Update to read from combatantData and filter:
   ```typescript
   // OLD:
   const dictatorDataList = props.gameView?.attributes?.settings?.dictatorData ||
                            props.state?.state?.settings?.dictatorData ||
                            props.gameView?.settings?.dictatorData || [];

   // NEW:
   const combatantData = props.gameView?.attributes?.settings?.combatantData ||
                         props.state?.state?.settings?.combatantData ||
                         props.gameView?.settings?.combatantData || [];
   const dictatorDataList = combatantData.filter((d: any) => d.cardType === 'dictator');
   ```
3. Verify the rest of the code works with the filtered list (it should, as the data structure is the same)
  </action>
  <verify>
- `npm run build` succeeds
- Dictator selection UI should work (if testable)
  </verify>
  <done>
- UI reads from combatantData and filters for dictators
- Build passes
  </done>
</task>

<task type="auto">
  <name>Task 3: Delete old data files and clean up comments</name>
  <files>data/mercs.json, data/dictators.json, src/rules/dictator-abilities.ts, src/rules/merc-abilities.ts</files>
  <action>
1. Delete the old data files:
   - `rm data/mercs.json`
   - `rm data/dictators.json`

2. Update comments that reference the old files:
   - In src/rules/dictator-abilities.ts line 5: Change "Dictator data: data/dictators.json" to "Dictator data: data/combatants.json (cardType='dictator')"
   - In src/rules/merc-abilities.ts line 175: Change "MERC ID matching mercs.json" to "MERC ID matching combatants.json (cardType='merc')"

3. Search for any other references to mercs.json or dictators.json and update them
  </action>
  <verify>
- `ls data/*.json` shows only combatants.json, equipment.json, sectors.json, dictator-tactics.json, setup.json
- `npm run build` succeeds
- `grep -r "mercs.json\|dictators.json" src/` returns no matches (except this plan file)
  </verify>
  <done>
- Old data files deleted
- Comments updated to reference combatants.json
- No remaining references to old file names
- Build passes
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` runs without new failures (pre-existing failures documented in STATE.md are acceptable)
- [ ] Old data files (mercs.json, dictators.json) deleted
- [ ] No code references to old file names
- [ ] Game can be constructed and loaded properly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors introduced
- Legacy data files removed
- All code uses combatants.json via combatantData
- Milestone v1.2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/13-remove-legacy/13-01-SUMMARY.md`:

# Phase 13 Plan 01: Remove Legacy Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Milestone v1.2 complete - all phases done]
</output>
