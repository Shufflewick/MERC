---
phase: 57-simple-hire-abilities
plan: 02
type: execute
wave: 2
depends_on: ["57-01"]
files_modified:
  - src/rules/flow.ts
  - src/ui/components/DictatorPanel.vue
  - src/ui/composables/useActionState.ts
  - src/ui/components/GameTable.vue
autonomous: true

must_haves:
  truths:
    - "Flow step offers gadafiBonusHire and stalinBonusHire to human dictator players"
    - "UI correctly routes both new actions through DictatorPanel"
    - "Hiring UI state (equipment selection, sector selection) activates for both new actions"
  artifacts:
    - path: "src/rules/flow.ts"
      provides: "Both action names in dictator-ability step"
      contains: "gadafiBonusHire.*stalinBonusHire"
    - path: "src/ui/components/DictatorPanel.vue"
      provides: "UI routing for new dictator actions"
      contains: "gadafiBonusHire.*stalinBonusHire"
    - path: "src/ui/composables/useActionState.ts"
      provides: "Action state detection for new hire actions"
      contains: "gadafiBonusHire.*stalinBonusHire"
    - path: "src/ui/components/GameTable.vue"
      provides: "Hiring state detection for new actions"
      contains: "gadafiBonusHire.*stalinBonusHire"
  key_links:
    - from: "src/rules/flow.ts"
      to: "action step actions array"
      via: "gadafiBonusHire and stalinBonusHire in actions array"
      pattern: "'gadafiBonusHire'.*'stalinBonusHire'"
    - from: "src/ui/components/DictatorPanel.vue"
      to: "dictatorSpecificActions array"
      via: "action name inclusion for UI routing"
      pattern: "gadafiBonusHire|stalinBonusHire"
---

<objective>
Wire Gaddafi and Stalin hire actions into the flow step and all UI files, ensuring the hiring UI activates correctly for both new actions.

Purpose: Without flow and UI wiring, the actions registered in Plan 01 will never be offered to human players. Every array/conditional that references `castroBonusHire` must also include the new action names.

Output: Complete UI routing so human dictator players can use Gaddafi and Stalin hire abilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/57-simple-hire-abilities/57-RESEARCH.md

Key source files:
@src/rules/flow.ts (lines 948-963 for dictator-ability step)
@src/ui/components/DictatorPanel.vue (lines 127-153)
@src/ui/composables/useActionState.ts (lines 170-175, 226-232, 243-249, 320-325)
@src/ui/components/GameTable.vue (line 903)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Flow step and UI wiring for both hire actions</name>
  <files>
    src/rules/flow.ts
    src/ui/components/DictatorPanel.vue
    src/ui/composables/useActionState.ts
    src/ui/components/GameTable.vue
  </files>
  <action>
1. **flow.ts** (~line 961): Add `'gadafiBonusHire'` and `'stalinBonusHire'` to the `actions` array in the `dictator-ability` actionStep:
   ```typescript
   actions: ['castroBonusHire', 'kimBonusMilitia', 'gadafiBonusHire', 'stalinBonusHire'],
   ```

2. **DictatorPanel.vue** (~line 128): Add `'gadafiBonusHire'` and `'stalinBonusHire'` to the `dictatorSpecificActions` array so the DictatorPanel handles these actions.

3. **DictatorPanel.vue** (~line 152): Add both action names to the sector selection conditional:
   ```typescript
   if (currentAction === 'castroBonusHire' || currentAction === 'kimBonusMilitia' || currentAction === 'generalissimoPick' || currentAction === 'lockdownPlaceMilitia' || currentAction === 'gadafiBonusHire' || currentAction === 'stalinBonusHire') {
   ```

4. **DictatorPanel.vue** (~line 134): Add computed properties for Gaddafi/Stalin hiring state (follow `isCastroHiring` pattern):
   ```typescript
   const isGadafiHiring = computed(() => {
     return props.actionController.currentAction.value === 'gadafiBonusHire';
   });
   const isStalinHiring = computed(() => {
     return props.actionController.currentAction.value === 'stalinBonusHire';
   });
   ```
   Check if `isCastroHiring` is used in the template -- if it triggers the main hiring UI in GameTable.vue instead, wire Gaddafi/Stalin equivalents the same way.

5. **useActionState.ts** -- there are 4 locations referencing `castroBonusHire`. Add `'gadafiBonusHire'` and `'stalinBonusHire'` at each:

   - **Line 172** (metadata check in `isAnyHireActive` or similar): Add to the metadata conditional:
     ```typescript
     metadata.castroBonusHire ||
     metadata.gadafiBonusHire ||
     metadata.stalinBonusHire;
     ```

   - **Line 229** (`getCurrentActionName` function): Add after the castroBonusHire check:
     ```typescript
     if (props.actionController.currentAction.value === 'gadafiBonusHire') return 'gadafiBonusHire';
     if (props.actionController.currentAction.value === 'stalinBonusHire') return 'stalinBonusHire';
     ```

   - **Line 246** (`hiringActions` array in `isHiringMercs` computed): Add both new actions:
     ```typescript
     const hiringActions = ['hireFirstMerc', 'hireSecondMerc', 'hireThirdMerc', 'dictatorHireFirstMerc', 'castroBonusHire', 'gadafiBonusHire', 'stalinBonusHire', 'selectDictator'];
     ```

   - **Line 323** (`isCastroHiring` computed): Add sibling computeds for Gaddafi/Stalin:
     ```typescript
     const isGadafiHiring = computed(() => {
       return props.actionController.currentAction.value === 'gadafiBonusHire';
     });
     const isStalinHiring = computed(() => {
       return props.actionController.currentAction.value === 'stalinBonusHire';
     });
     ```
     Include these in the returned object from the composable (follow the pattern of how `isCastroHiring` is returned).

6. **GameTable.vue** (~line 903): Add `'gadafiBonusHire'` and `'stalinBonusHire'` to the `hiringActions` array:
   ```typescript
   const hiringActions = ['placeLanding', 'selectDictator', 'hireFirstMerc', 'hireSecondMerc', 'hireThirdMerc', 'dictatorHireFirstMerc', 'castroBonusHire', 'gadafiBonusHire', 'stalinBonusHire'];
   ```
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Then grep all source files for `castroBonusHire` and verify that every array/conditional containing it also contains `gadafiBonusHire` and `stalinBonusHire`.
  </verify>
  <done>
Flow step lists all 4 dictator ability actions. All 3 UI files route the new action names correctly. No `castroBonusHire` reference exists without corresponding Gaddafi/Stalin entries.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify with type check and test suite</name>
  <files></files>
  <action>
1. Run `npx tsc --noEmit` -- must pass clean
2. Run the existing test suite: `npx vitest run` -- all existing tests must still pass
3. Grep the codebase for any remaining references to `castroBonusHire` that might indicate a missed UI wiring point. Every array containing `castroBonusHire` should also contain `gadafiBonusHire` and `stalinBonusHire`.
4. Verify the switch statement in `applyDictatorTurnAbilities` now handles `'gadafi'` and `'stalin'` cases.
5. Verify the `registerAllActions` function registers both new actions.
  </action>
  <verify>
`npx tsc --noEmit` exits 0. `npx vitest run` exits 0 with no new failures.
  </verify>
  <done>
All type checks pass, all existing tests pass, no wiring gaps found. Phase 57 implementation is complete.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes clean
2. `npx vitest run` passes with no regressions
3. Every occurrence of `castroBonusHire` in UI files has corresponding `gadafiBonusHire` and `stalinBonusHire` entries
4. Flow step `dictator-ability` lists all 4 ability action names
</verification>

<success_criteria>
- Flow step includes gadafiBonusHire and stalinBonusHire
- All 4 useActionState.ts locations updated (lines 172, 229, 246, 323)
- DictatorPanel.vue routes both new actions
- GameTable.vue hiringActions includes both new actions
- TypeScript compiles clean, existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/57-simple-hire-abilities/57-02-SUMMARY.md`
</output>
