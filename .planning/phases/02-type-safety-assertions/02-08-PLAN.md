---
phase: 02-type-safety-assertions
plan: 08
type: execute
---

<objective>
Fix type assertions in remaining files (combat.ts, rebel-combat.ts, ai-helpers.ts, elements.ts).

Purpose: Complete the type assertion cleanup across all remaining rules files.
Output: All rules files free of `as any` casts, using proper type guards and helpers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-08-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-type-safety-assertions/02-01-SUMMARY.md
@.planning/phases/02-type-safety-assertions/02-07-SUMMARY.md

@src/rules/combat.ts
@src/rules/actions/rebel-combat.ts
@src/rules/ai-helpers.ts
@src/rules/elements.ts
@src/rules/actions/helpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix combat.ts and rebel-combat.ts assertions</name>
  <files>src/rules/combat.ts, src/rules/actions/rebel-combat.ts</files>
  <action>
Fix assertions in combat files (~55 total):

**combat.ts (~28):**
- Most are likely safe type assertions for combat logic
- Check for any `as any` patterns
- The file has many `is*` functions already - these are good patterns

**rebel-combat.ts (~27):**
- Similar patterns to other action files
- `ctx.player as RebelPlayer` - Use type narrowing
- `element as unknown as Type` - Use helpers

Apply same patterns as previous plans.
  </action>
  <verify>
1. `grep -c "as any" src/rules/combat.ts` returns 0
2. `grep -c "as any" src/rules/actions/rebel-combat.ts` returns 0
  </verify>
  <done>Combat files cleaned of unsafe assertions</done>
</task>

<task type="auto">
  <name>Task 2: Fix ai-helpers.ts and elements.ts assertions</name>
  <files>src/rules/ai-helpers.ts, src/rules/elements.ts</files>
  <action>
Fix remaining files:

**ai-helpers.ts (~5):**
- `game.dictatorPlayer.dictator as any` - Check what type is expected
- Any player-related casts

**elements.ts (~6):**
- Check for any `as` patterns beyond `as const`
- These may be type definitions, which are generally fine

Also do a final sweep:
```bash
grep -rn " as any" src/rules/ --include="*.ts" | grep -v ".test.ts"
```

Any remaining `as any` should be documented if they can't be fixed (framework limitations).
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npm test` passes
3. Final `grep -c " as any" src/rules/` shows minimal or zero hits
  </verify>
  <done>All remaining files cleaned, phase complete</done>
</task>

<task type="auto">
  <name>Task 3: Final verification and cleanup</name>
  <files>src/rules/</files>
  <action>
Final checks:
1. Run full test suite: `npm test`
2. Run type check: `npx tsc --noEmit`
3. Count remaining assertions:
   ```bash
   grep -rn " as any" src/rules/ --include="*.ts" | grep -v ".test.ts" | wc -l
   ```
4. If any `as any` remain, document in summary why they're necessary

Update ROADMAP.md to mark Phase 2 complete.
Update STATE.md with phase completion.
  </action>
  <verify>
1. `npm test` passes
2. `npx tsc --noEmit` passes
3. All `as any` either removed or documented
  </verify>
  <done>Phase 2 complete, all type assertions addressed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes
- [ ] `as any` count in src/rules/ is zero or near-zero
- [ ] Any remaining casts documented
</verification>

<success_criteria>

- All rules files use proper type assertions
- No `as any` casts (or documented exceptions)
- All tests pass
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-assertions/02-08-SUMMARY.md`
</output>
