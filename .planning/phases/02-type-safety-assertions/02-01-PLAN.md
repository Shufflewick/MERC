---
phase: 02-type-safety-assertions
plan: 01
type: execute
---

<objective>
Create type guard utilities and fix game.ts assertions.

Purpose: Establish foundation utilities that other files will use, fix high-risk `(game as any).property` patterns.
Output: Type guard helpers in helpers.ts, properly typed game.ts with no unsafe assertions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-type-safety-combat/01-01-SUMMARY.md

@src/rules/game.ts
@src/rules/actions/helpers.ts

**Constraining decisions:**
- Phase 1: Used `import type` for circular dependency avoidance

**Patterns from Phase 1:**
- Type-only imports for cross-module types
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add typed assertion helpers to helpers.ts</name>
  <files>src/rules/actions/helpers.ts</files>
  <action>
Add type-safe assertion helpers for common patterns:

1. `asRebelPlayer(player: MERCPlayer): RebelPlayer` - throws if not rebel
2. `asRebelPlayerOrNull(player: MERCPlayer | undefined): RebelPlayer | null` - returns null if not rebel
3. `asMercCard(element: unknown): MercCard` - throws if not MercCard
4. `asSector(element: unknown): Sector` - throws if not Sector
5. `asTacticsCard(element: unknown): TacticsCard` - throws if not TacticsCard
6. `asEquipment(element: unknown): Equipment` - throws if not Equipment
7. `getTypedArg<T>(args: Record<string, unknown>, key: string): T | undefined` - returns undefined if missing

Each assertion helper should:
- Check with instanceof or type guard
- Return properly typed value
- Throw descriptive error if type mismatch (e.g., "Expected RebelPlayer but got DictatorPlayer")

Import required types using `import type` where needed to avoid circular dependencies.
  </action>
  <verify>TypeScript compiles with no errors: `npx tsc --noEmit`</verify>
  <done>7 assertion helpers added to helpers.ts, all type-safe with descriptive errors</done>
</task>

<task type="auto">
  <name>Task 2: Fix game.ts type assertions</name>
  <files>src/rules/game.ts</files>
  <action>
Fix the ~36 type assertions in game.ts:

1. Remove unnecessary `as any` casts where type already matches
2. Use the new assertion helpers from helpers.ts where appropriate
3. For `game.settings[key] as Type` patterns:
   - These are generally safe (known keys with known types)
   - Keep as-is OR add a typed getter if pattern repeats

Focus on eliminating `as any` first (highest risk), then address `as Type` casts.

Do NOT add helpers for patterns that only appear once - inline type guards are fine for one-off cases.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `grep -c " as any" src/rules/game.ts` returns 0 or very low count
3. `npm test` passes
  </verify>
  <done>game.ts has no `as any` casts, remaining assertions are validated or genuinely safe patterns</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes
- [ ] No `as any` in game.ts
- [ ] helpers.ts exports assertion utilities
</verification>

<success_criteria>

- Assertion helpers created in helpers.ts
- game.ts cleaned of unsafe `as any` patterns
- All tests pass
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-assertions/02-01-SUMMARY.md`
</output>
