---
phase: 02-type-safety-assertions
plan: 06
type: execute
---

<objective>
Fix type assertions in rebel-equipment.ts (largest file).

Purpose: Eliminate 95 unsafe type assertions in rebel equipment actions.
Output: Properly typed rebel-equipment.ts using assertion helpers and type narrowing.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-06-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-type-safety-assertions/02-01-SUMMARY.md
@.planning/phases/02-type-safety-assertions/02-05-SUMMARY.md

@src/rules/actions/rebel-equipment.ts
@src/rules/actions/helpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix rebel-equipment.ts player and type guard assertions</name>
  <files>src/rules/actions/rebel-equipment.ts</files>
  <action>
Fix player-related assertions (~40):
- `game.isRebelPlayer(ctx.player as any)` - Remove `as any`
- `game.isDictatorPlayer(ctx.player as any)` - Remove `as any`
- `player as RebelPlayer` - Use type narrowing or helper
- `ctx.player as RebelPlayer` - Use type narrowing or helper
- `ctx.game as MERCGame` - Investigate if needed (may indicate type issue)

Special attention to patterns like:
```typescript
const g = ctx.game as MERCGame;
```
This suggests `ctx.game` has a different type. If from framework, use cast to `MERCGame` (safer than not typing at all).
  </action>
  <verify>`grep -c "as any" src/rules/actions/rebel-equipment.ts` is significantly reduced</verify>
  <done>Player and game assertions fixed, ~40 casts addressed</done>
</task>

<task type="auto">
  <name>Task 2: Fix rebel-equipment.ts element assertions</name>
  <files>src/rules/actions/rebel-equipment.ts</files>
  <action>
Fix element-related assertions (~30):
- `element as unknown as MercCard` - Use `asMercCard()` helper
- `element as unknown as Sector` - Use `asSector()` helper
- `element as unknown as Equipment` - Use `asEquipment()` helper
- `unit as MercCard` - Use type narrowing

Note the existing local helper `isDictatorCardForEquip` - follow that pattern for new type guards.
  </action>
  <verify>No `as unknown as` patterns remain</verify>
  <done>Element assertions use proper helpers or type guards</done>
</task>

<task type="auto">
  <name>Task 3: Fix rebel-equipment.ts args and getElementById assertions</name>
  <files>src/rules/actions/rebel-equipment.ts</files>
  <action>
Fix remaining assertions (~25):

**Args casts:**
- `args.equipment as Equipment` - Use helper
- `args.merc as MercCard` - Use helper
- `args.actingMerc as MercCard` - Use helper
- `args.targetSector as Sector` - Use helper
- `args.equipmentType as 'Weapon' | 'Armor' | 'Accessory'` - Safe for known union

**getElementById casts:**
- `game.getElementById(id) as MercCard` - Add null check + cast or use helper
- `game.getElementById(id) as Equipment` - Same
- `game.getElementById(id) as Sector` - Same

**Misc:**
- `(mercArg as any)?.id` - Fix to use proper type
- `(equipArg as any)?.id` - Fix to use proper type
- `item.equipmentType as any` - Check what's expected
- `game.hagnessDrawnEquipmentData[key] = data as any` - Add proper typing

**Discard arrays:**
- `game.weaponsDiscard?.children as Equipment[]` - Generally safe if children is Element[]
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npm test` passes
3. No `as any` patterns remain
  </verify>
  <done>All rebel-equipment.ts assertions fixed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes
- [ ] No `as any` in rebel-equipment.ts
- [ ] Minimal `as unknown as` patterns
</verification>

<success_criteria>

- rebel-equipment.ts uses proper type assertions
- No `as any` casts
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-assertions/02-06-SUMMARY.md`
</output>
