---
phase: 02-type-safety-assertions
plan: 05
type: execute
---

<objective>
Fix type assertions in rebel-economy.ts.

Purpose: Eliminate 70 unsafe type assertions in rebel economy actions.
Output: Properly typed rebel-economy.ts using assertion helpers and type narrowing.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-05-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-type-safety-assertions/02-01-SUMMARY.md
@.planning/phases/02-type-safety-assertions/02-04-SUMMARY.md

@src/rules/actions/rebel-economy.ts
@src/rules/actions/helpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix rebel-economy.ts player assertions</name>
  <files>src/rules/actions/rebel-economy.ts</files>
  <action>
Fix player-related assertions (~30):
- `game.isRebelPlayer(ctx.player as any)` - Remove `as any`
- `game.isDictatorPlayer(ctx.player as any)` - Remove `as any`
- `player as RebelPlayer` - Use type narrowing or helper
- `ctx.player as RebelPlayer` - Use type narrowing or helper

Apply same pattern as rebel-movement.ts (02-04).

Note: This file has local helper functions like `isDictatorCardUnit`, `isUnitOwnedForExplore` that already use proper type guards. Use similar patterns.
  </action>
  <verify>`grep -c "player as any" src/rules/actions/rebel-economy.ts` returns 0</verify>
  <done>Player assertions fixed, no `as any` for player casts</done>
</task>

<task type="auto">
  <name>Task 2: Fix rebel-economy.ts element and args assertions</name>
  <files>src/rules/actions/rebel-economy.ts</files>
  <action>
Fix remaining assertions (~40):

**Element casts:**
- `element as unknown as MercCard` - Use `asMercCard()` helper
- `element as unknown as Sector` - Use `asSector()` helper
- `unit as MercCard` - Use type narrowing after type guard

**Args casts:**
- `args.equipment as Equipment` - Use `asEquipment()` or validate
- `args.actingMerc as MercCard` - Use helper
- `args.actingUnit as string` - Safe for string choices
- `args.unit as string` - Safe for string choices
- `ctx.data?.X as string` - Check for undefined first

**getElementById casts:**
- `game.getElementById(id) as Sector` - Use helper or add null check
- `game.getElementById(sectorArg) as Sector` - Same

**Settings casts:**
- `game.settings[key] as number[]` - Generally safe, known keys

Focus on eliminating `as any` and `as unknown as` first. `as Type` for known values can remain if they're genuinely safe patterns.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npm test` passes
3. No `as any` or `as unknown as` patterns
  </verify>
  <done>rebel-economy.ts assertions fixed with proper type handling</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes
- [ ] No `as any` in rebel-economy.ts
- [ ] Reduced unsafe assertion patterns
</verification>

<success_criteria>

- rebel-economy.ts uses proper type assertions
- No `as any` casts
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-assertions/02-05-SUMMARY.md`
</output>
