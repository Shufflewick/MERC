---
phase: 02-type-safety-assertions
plan: 02
type: execute
---

<objective>
Fix type assertions in flow.ts and tactics-effects.ts.

Purpose: Eliminate high-risk `(game as any).property` patterns that indicate missing type definitions.
Output: Properly typed flow.ts and tactics-effects.ts with no unsafe assertions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-type-safety-assertions/02-01-SUMMARY.md

@src/rules/flow.ts
@src/rules/tactics-effects.ts
@src/rules/game.ts
@src/rules/actions/helpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix tactics-effects.ts (game as any) patterns</name>
  <files>src/rules/tactics-effects.ts, src/rules/game.ts</files>
  <action>
tactics-effects.ts has these patterns:
- `(game as any).conscriptsActive = true`
- `(game as any).conscriptsAmount = ...`
- `(game as any).oilReservesActive = true`

These are dynamic properties being added to game. Two approaches:

**Preferred:** Add optional properties to MERCGame class in game.ts:
```typescript
// Tactics card state
conscriptsActive?: boolean;
conscriptsAmount?: number;
oilReservesActive?: boolean;
```

Then remove the `as any` casts in tactics-effects.ts.

This is preferred because these are real game state, not arbitrary data.
  </action>
  <verify>
1. `grep -c "game as any" src/rules/tactics-effects.ts` returns 0
2. `npx tsc --noEmit` passes
  </verify>
  <done>tactics-effects.ts has no (game as any) casts, game.ts has proper typed properties</done>
</task>

<task type="auto">
  <name>Task 2: Fix flow.ts player type assertions</name>
  <files>src/rules/flow.ts</files>
  <action>
flow.ts has these patterns:
- `game.isRebelPlayer(player as any)` - The type guard accepts MERCPlayer, cast is unnecessary
- `game.isDictatorPlayer(player as any)` - Same issue
- `ctx.player as RebelPlayer` - Should use assertion helper or type narrowing

For the filter callbacks in eachPlayer:
```typescript
filter: (player) => game.isRebelPlayer(player as any)
```

The `player` parameter type likely comes from the BoardSmith framework. Check what type eachPlayer provides. If it's `Player` (base class), and MERCPlayer extends Player, then:
1. The cast to `any` is working around a type mismatch
2. Fix: Either update the filter signature or use a type assertion that's safe

For `ctx.player as RebelPlayer`:
- After `game.isRebelPlayer(ctx.player)` check, TypeScript should narrow the type
- If it doesn't, use the assertion helper from 02-01

Do NOT change framework types - only fix the MERC codebase assertions.
  </action>
  <verify>
1. `grep -c " as any" src/rules/flow.ts` returns 0 or lower than before
2. `npx tsc --noEmit` passes
3. `npm test` passes
  </verify>
  <done>flow.ts player type assertions fixed, using proper type narrowing or assertion helpers</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm test` passes
- [ ] No `(game as any)` in tactics-effects.ts
- [ ] Reduced/eliminated `as any` in flow.ts
</verification>

<success_criteria>

- tactics-effects.ts properly typed with game properties
- flow.ts player assertions fixed
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-type-safety-assertions/02-02-SUMMARY.md`
</output>
