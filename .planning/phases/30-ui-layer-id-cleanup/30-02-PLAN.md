---
phase: 30-ui-layer-id-cleanup
plan: 02
type: execute
---

<objective>
Remove legacy mercName/dictatorName fallback chains and update data mappings to use combatantName consistently.

Purpose: Complete the UI layer cleanup by removing backward-compatibility fallbacks now that interfaces use combatantName.
Output: Clean UI components with combatantName as the only identity property.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-ui-layer-id-cleanup/30-01-SUMMARY.md

**Prior context:**
- Plan 30-01 updated interfaces to use combatantName
- Fallback chains like `merc.combatantName || merc.mercName` still exist for runtime compat
- Data mapping code sets both combatantName and mercName

**Scope:**
- CombatantCard.vue: 1 fallback in computed (line 79)
- SectorTile.vue: 3 fallback chains in getMercKey + templates (lines 68, 210, 249, 253)
- SquadPanel.vue: 1 fallback chain in getMercKey (line 67)
- DictatorPanel.vue: 5 fallback chains in templates (lines 411, 419, 499, 535, 541)
- SectorPanel.vue: 2 data mappings (lines 970, 1050)
- GameBoard.vue: ~13 occurrences across data mapping and fallbacks
- tests/error-conditions.test.ts: 1 test fixture (line 293)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up CombatantCard.vue and SectorTile.vue</name>
  <files>src/ui/components/CombatantCard.vue, src/ui/components/SectorTile.vue</files>
  <action>
1. CombatantCard.vue:
   - Line 79: Change `getProp('mercName', '')` to `getProp('combatantName', '')` in fallback chain

2. SectorTile.vue:
   - Line 68 (getMercKey): Remove `|| merc.mercName` from fallback chain
   - Line 210 (:alt): Change to `:alt="merc.combatantName || merc.combatantId"`
   - Line 249 (:alt): Change to `:alt="merc.combatantName || merc.combatantId"`
   - Line 253 (tooltip): Change to `{{ merc.combatantName || merc.combatantId }}`
  </action>
  <verify>grep -n "mercName" src/ui/components/CombatantCard.vue src/ui/components/SectorTile.vue</verify>
  <done>CombatantCard and SectorTile have no mercName references except interface backward-compat</done>
</task>

<task type="auto">
  <name>Task 2: Clean up SquadPanel.vue and DictatorPanel.vue</name>
  <files>src/ui/components/SquadPanel.vue, src/ui/components/DictatorPanel.vue</files>
  <action>
1. SquadPanel.vue:
   - Line 67 (getMercKey): Remove `|| merc.mercName` from fallback chain

2. DictatorPanel.vue:
   - Line 411 (:alt): Change to `:alt="dictator.combatantName || dictator.dictatorId"`
   - Line 419 (name span): Change to `{{ dictator.combatantName }}`
   - Line 499 (:combatant-name): Change to `:combatant-name="dictator?.combatantName"`
   - Line 535 (:alt): Change to `:alt="dictator.combatantName"`
   - Line 541 (h2): Change to `{{ dictator.combatantName }}`
  </action>
  <verify>grep -n "dictatorName" src/ui/components/DictatorPanel.vue</verify>
  <done>SquadPanel and DictatorPanel have no mercName/dictatorName in logic/templates</done>
</task>

<task type="auto">
  <name>Task 3: Clean up SectorPanel.vue and GameBoard.vue data mappings</name>
  <files>src/ui/components/SectorPanel.vue, src/ui/components/GameBoard.vue</files>
  <action>
1. SectorPanel.vue:
   - Line 970: Change `mercName:` key to `combatantName:` in data mapping
   - Line 1050: Change `mercName:` key to `combatantName:` in data mapping

2. GameBoard.vue - Update data mappings and fallback chains:
   - Line 688: Change `mercName:` to `combatantName:`
   - Line 865: Change `mercName:` to `combatantName:`
   - Line 958: Change `mercName:` to `combatantName:`
   - Line 1003: Change `dictatorName:` to `combatantName:` (placeholder object)
   - Line 1028: Change `dictatorName:` to `combatantName:`
   - Lines 1582-1588: Rename local variable `mercName` to `combatantName` (local var for action args)
   - Line 1604: Remove `|| (merc as any).mercName` fallback
   - Lines 1883-1884: Rename local variable `mercName` to `combatantName`
   - Lines 1932-1966: Change `mercName:` data keys to `combatantName:`
   - Lines 2025, 2031: Remove `|| merc.mercName` fallbacks
  </action>
  <verify>grep -c "mercName\|dictatorName" src/ui/components/SectorPanel.vue src/ui/components/GameBoard.vue</verify>
  <done>SectorPanel and GameBoard use combatantName consistently</done>
</task>

<task type="auto">
  <name>Task 4: Update test fixture</name>
  <files>tests/error-conditions.test.ts</files>
  <action>
Line 293: Update test fixture from:
  `const fakeCard = { dictatorId: 'fake', dictatorName: 'Fake' };`
to:
  `const fakeCard = { combatantId: 'fake', combatantName: 'Fake' };`

This is a test for isCombatantModel returning false for plain objects - the fixture just needs id/name properties.
  </action>
  <verify>grep -n "combatantName" tests/error-conditions.test.ts</verify>
  <done>Test fixture uses combatantName instead of dictatorName</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] `npm test` passes all tests
- [ ] grep for mercName/dictatorName returns only interface backward-compat properties
- [ ] Phase 30 complete - v1.6 milestone finished
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No mercName/dictatorName in UI logic or templates (only interface properties for backward compat)
- v1.6 Final ID Cleanup milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/30-ui-layer-id-cleanup/30-02-SUMMARY.md`
</output>
