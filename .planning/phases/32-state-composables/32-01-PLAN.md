---
phase: 32
plan: 01
wave: 1
depends_on: []
files_modified:
  - src/ui/composables/usePlayerState.ts (new)
autonomous: true
---

# Plan 01: Create usePlayerState Composable

## Objective

Extract player-related state derivation from GameBoard.vue into `src/ui/composables/usePlayerState.ts`. This composable provides player colors, position mapping, and dictator detection.

## Context

**Source:** GameBoard.vue lines 370-478, 594-601

**Requirement:** STATE-01 - players, currentPlayerColor, playerColorMap, dictatorPlayerColor, currentPlayerIsDictator, positionToColor

## Tasks

<task id="1">
Read GameBoard.vue to locate the exact code for:
- `players` computed (lines ~370-425)
- `currentPlayerColor` computed (lines ~428-439)
- `playerColorMap` computed (lines ~442-450)
- `dictatorPlayerColor` computed (lines ~453-456)
- `currentPlayerIsDictator` computed (lines ~460-478)
- `positionToColor` function (lines ~594-601)
</task>

<task id="2">
Create `src/ui/composables/usePlayerState.ts` with this structure:

```typescript
import { computed, type ComputedRef, type Ref, unref } from 'vue';
import { useGameViewHelpers } from './useGameViewHelpers';

export interface Player {
  position: number;
  playerColor: string;
  isDictator: boolean;
}

export interface PlayerState {
  players: ComputedRef<Player[]>;
  currentPlayerColor: ComputedRef<string>;
  playerColorMap: ComputedRef<Record<string, string>>;
  dictatorPlayerColor: ComputedRef<string>;
  currentPlayerIsDictator: ComputedRef<boolean>;
  positionToColor: (position: string | number) => string;
}

export function usePlayerState(
  getGameView: () => any,
  playerPosition: Ref<number> | number
): PlayerState {
  const { findAllByClassName, getAttr } = useGameViewHelpers(getGameView);

  // Extract players computed logic here
  const players = computed(() => {
    // ... from GameBoard.vue
  });

  // Extract currentPlayerColor computed
  const currentPlayerColor = computed(() => {
    // ...
  });

  // Extract playerColorMap computed
  const playerColorMap = computed(() => {
    // ...
  });

  // Extract dictatorPlayerColor computed
  const dictatorPlayerColor = computed(() => {
    // ...
  });

  // Extract currentPlayerIsDictator computed
  const currentPlayerIsDictator = computed(() => {
    // ...
  });

  // positionToColor helper (uses players.value)
  function positionToColor(position: string | number): string {
    const posNum = typeof position === 'string' ? parseInt(position) : position;
    const p = players.value.find(p => p.position === posNum);
    return p?.playerColor || '';
  }

  return {
    players,
    currentPlayerColor,
    playerColorMap,
    dictatorPlayerColor,
    currentPlayerIsDictator,
    positionToColor,
  };
}
```
</task>

<task id="3">
Extract exact logic from GameBoard.vue for each computed:

**players:**
- Find RebelPlayer and DictatorPlayer elements
- Build array with position, playerColor, isDictator
- Handle playerColor attribute fallback

**currentPlayerColor:**
- Find player matching playerPosition
- Return their color

**playerColorMap:**
- Build Record<position, color> for militia display

**dictatorPlayerColor:**
- Find dictator player, return their color

**currentPlayerIsDictator:**
- Check if current player's role is dictator
</task>

<task id="4">
Verify TypeScript compiles without errors:
```bash
npx tsc --noEmit
```
</task>

## Verification

<verify>
1. File exists at src/ui/composables/usePlayerState.ts
2. TypeScript compiles without errors
3. Exports: usePlayerState function
4. Returns: players, currentPlayerColor, playerColorMap, dictatorPlayerColor, currentPlayerIsDictator, positionToColor
5. Uses useGameViewHelpers for tree queries
</verify>

## Must Haves

- [ ] `players` returns array with position, playerColor, isDictator for each player
- [ ] `currentPlayerColor` returns color string for current player position
- [ ] `playerColorMap` returns Record<position, color>
- [ ] `dictatorPlayerColor` returns dictator's specific color
- [ ] `currentPlayerIsDictator` returns boolean
- [ ] `positionToColor` converts position to color string
- [ ] All computeds use Vue's computed() for reactivity
- [ ] TypeScript types exported for Player and PlayerState
