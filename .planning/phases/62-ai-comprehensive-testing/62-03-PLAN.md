---
phase: 62-ai-comprehensive-testing
plan: 03
type: execute
wave: 2
depends_on: ["62-01"]
files_modified:
  - tests/dictator-ai-integration.test.ts
autonomous: true

must_haves:
  truths:
    - "AI can play a full game as each of the 9 expansion dictators without errors"
    - "Each AI dictator game executes at least 10 actions (game is meaningfully played, not stuck)"
    - "Integration tests exercise setup, per-turn, and reactive abilities through natural gameplay"
  artifacts:
    - path: "tests/dictator-ai-integration.test.ts"
      provides: "Integration tests for AI playing full games as each expansion dictator"
      min_lines: 100
  key_links:
    - from: "tests/dictator-ai-integration.test.ts"
      to: "tests/helpers/auto-play.ts"
      via: "import shared helpers"
      pattern: "import.*auto-play"
    - from: "tests/dictator-ai-integration.test.ts"
      to: "boardsmith/runtime"
      via: "GameRunner for AI game simulation"
      pattern: "import.*GameRunner"
---

<objective>
Write integration tests that verify AI can play a complete game as each of the 9 expansion dictators without errors.

Purpose: End-to-end verification that all AI decision paths work correctly through natural gameplay flow, exercising setup abilities, per-turn abilities, and reactive abilities in combination.

Output: `tests/dictator-ai-integration.test.ts` with one test per expansion dictator (9 total), plus multi-seed coverage.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/62-ai-comprehensive-testing/62-RESEARCH.md
@.planning/phases/62-ai-comprehensive-testing/62-01-SUMMARY.md

@tests/helpers/auto-play.ts (shared autoResolveArgs, getCurrentAction, playUntilComplete)
@tests/ai-rebel-batching.test.ts (GameRunner creation pattern with dictatorChoice + playerConfigs)
@src/rules/game.ts (MERCGame)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integration tests for all 9 expansion dictators</name>
  <files>tests/dictator-ai-integration.test.ts</files>
  <action>
Create `tests/dictator-ai-integration.test.ts` with integration tests verifying AI can play a full game as each expansion dictator.

**Game creation helper:**
Create a local helper `createAIDictatorGame(dictator: string, seed: string): GameRunner<MERCGame>` following the pattern from ai-rebel-batching.test.ts:

```typescript
function createAIDictatorGame(dictator: string, seed: string): GameRunner<MERCGame> {
  return new GameRunner<MERCGame>({
    GameClass: MERCGame,
    gameType: 'merc',
    gameOptions: {
      playerCount: 2,
      playerNames: ['AIRebel', 'DictatorBot'],
      seed,
      dictatorIsAI: true,
      dictatorChoice: dictator,
      playerConfigs: [
        { color: '#e74c3c', isDictator: false, isAI: true },
        { color: '#95a5a6', isDictator: true, isAI: true, aiLevel: 'medium' },
      ],
    } as any,
  });
}
```

**Import** `autoResolveArgs`, `getCurrentAction`, and `playUntilComplete` from `./helpers/auto-play.js`.

**Test structure:**
One `describe('AI Dictator Integration')` with a parameterized test for each dictator. Use the internal IDs: `gadafi`, `hitler`, `hussein`, `mao`, `mussolini`, `noriega`, `pinochet`, `polpot`, `stalin`.

For each dictator, create an `it` block that:
1. Creates an AI game with `createAIDictatorGame(dictatorId, seed)`
2. Calls `runner.start()`
3. Uses `playUntilComplete(runner, 500)` to auto-play up to 500 actions
4. Asserts `actionCount > 10` (game meaningfully progressed, not stuck on action 1)
5. Verifies the game's dictator is the correct one: `runner.game.dictatorPlayer.dictator.combatantId === dictatorId`

**Use 2 seeds per dictator** for coverage diversity. Structure as:

```typescript
const EXPANSION_DICTATORS = [
  'gadafi', 'hitler', 'hussein', 'mao', 'mussolini',
  'noriega', 'pinochet', 'polpot', 'stalin',
];

for (const dictator of EXPANSION_DICTATORS) {
  it(`AI plays as ${dictator} (seed 1)`, () => { ... seed: `${dictator}-int-1` ... });
  it(`AI plays as ${dictator} (seed 2)`, () => { ... seed: `${dictator}-int-2` ... });
}
```

**Timeout:** These tests simulate many game actions and may take a few seconds each. Set a per-test timeout if needed: `it('...', () => { ... }, 30_000)`.

**Assertion strategy:**
- Primary: `actionCount > 10` (game progressed past Day 1 setup)
- Secondary: No uncaught errors (test completes without throw)
- Optional: If `completed` is true, the game reached a natural end state

Do NOT assert on specific game outcomes (who wins, specific sector counts). These are non-deterministic. Assert on "game played without errors and progressed meaningfully."

**Edge case:** If `playUntilComplete` returns `actionCount <= 10` for a specific dictator/seed combo, the test should still pass if the game completed naturally (some seeds may create short games). Only fail if `actionCount <= 10 AND !completed` (game got stuck).
  </action>
  <verify>`npx vitest run tests/dictator-ai-integration.test.ts` - all 18 tests pass (9 dictators x 2 seeds).</verify>
  <done>All 9 expansion dictators have passing integration tests with 2 seeds each, verifying AI can play a full game without errors.</done>
</task>

</tasks>

<verification>
- `npx vitest run tests/dictator-ai-integration.test.ts` passes all 18 tests
- Each test verifies the correct dictator was selected
- Each test verifies meaningful game progression (actionCount > 10 or game completed)
- No test relies on specific game outcomes
</verification>

<success_criteria>
- tests/dictator-ai-integration.test.ts exists with 18 test cases (9 dictators x 2 seeds)
- All tests pass without errors
- Tests use shared helpers from tests/helpers/auto-play.ts
- AI dictator games progress past Day 1 setup into normal gameplay
</success_criteria>

<output>
After completion, create `.planning/phases/62-ai-comprehensive-testing/62-03-SUMMARY.md`
</output>
