---
phase: 26-update-references
plan: 01
type: execute
---

<objective>
Clean up backward-compat exports and simplify type annotations by using CombatantModel instead of MercCard | DictatorCard unions.

Purpose: Complete the v1.5 milestone by removing unused exports and standardizing on the unified combatant type.
Output: Cleaner exports, simplified type annotations, no unused backward-compat aliases.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-remove-id-aliases/25-04-SUMMARY.md

**Prior summaries (dependency graph):**
- Phase 24: Made CombatantModel concrete with unified ID properties
- Phase 25: Removed all backward-compat ID alias getters

**Key files:**
@src/rules/index.ts
@src/rules/elements.ts
@src/rules/actions/helpers.ts

**Constraints:**
- MercCard/DictatorCard classes MUST remain for classRegistry (BoardSmith framework requirement)
- Keep all exports of MercCard, DictatorCard, CombatantModel, CombatantBase
- Only remove the redundant backward-compat ALIASES (CombatUnit, CombatUnitCard, isCombatUnitCard)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove backward-compat export aliases</name>
  <files>src/rules/index.ts, src/rules/elements.ts, src/rules/actions/helpers.ts</files>
  <action>
Remove the following unused backward-compat exports:

1. In src/rules/index.ts:
   - Remove line 43: `export { CombatantBase as CombatUnit, CombatantModel as CombatUnitCard } from './elements.js';`

2. In src/rules/elements.ts:
   - Remove lines 872-873 (the CombatUnitCard alias comment and export)

3. In src/rules/actions/helpers.ts:
   - Remove line 246: `export const isCombatUnitCard = isCombatantModel;`
   - On line 510, remove the `, CombatantModel as CombatUnitCard` from the type export

These aliases are not used anywhere in the codebase (verified via grep).
  </action>
  <verify>
npm run build passes (no import errors for removed exports)
grep -r "CombatUnitCard\|CombatUnit[^C]\|isCombatUnitCard" src/ tests/ returns no results
  </verify>
  <done>All backward-compat aliases removed, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Replace MercCard | DictatorCard type aliases with CombatantModel</name>
  <files>src/rules/ai-executor.ts, src/rules/actions/rebel-economy.ts, src/rules/actions/rebel-equipment.ts, src/rules/actions/dictator-actions.ts</files>
  <action>
Replace local type aliases that define `MercCard | DictatorCard` with `CombatantModel`:

1. In src/rules/ai-executor.ts:
   - Line 35: Change `type DictatorUnit = MercCard | DictatorCard;` to `type DictatorUnit = CombatantModel;`
   - Ensure CombatantModel is imported from elements.js

2. In src/rules/actions/rebel-economy.ts:
   - Line 265: `type ExplorableUnit = MercCard | DictatorCard;` → `type ExplorableUnit = CombatantModel;`
   - Line 466: `type CollectableUnit = MercCard | DictatorCard;` → `type CollectableUnit = CombatantModel;`
   - Line 715: `type TrainableUnit = MercCard | DictatorCard;` → `type TrainableUnit = CombatantModel;`
   - Line 920: `type CityUnit = MercCard | DictatorCard;` → `type CityUnit = CombatantModel;`
   - Ensure CombatantModel is imported

3. In src/rules/actions/rebel-equipment.ts:
   - Line 41: `type EquippableUnit = MercCard | DictatorCard;` → `type EquippableUnit = CombatantModel;`
   - Ensure CombatantModel is imported

4. In src/rules/actions/dictator-actions.ts:
   - Line 29: `type DictatorUnit = MercCard | DictatorCard;` → `type DictatorUnit = CombatantModel;`
   - Ensure CombatantModel is imported
  </action>
  <verify>npm run build passes, npm test passes</verify>
  <done>All local type aliases use CombatantModel, build and tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Replace inline MercCard | DictatorCard unions with CombatantModel</name>
  <files>src/rules/actions/rebel-movement.ts, src/rules/actions/helpers.ts, src/rules/combat-types.ts</files>
  <action>
Replace inline `MercCard | DictatorCard` type annotations with `CombatantModel`:

1. In src/rules/actions/rebel-movement.ts:
   - Line 629: `(MercCard | DictatorCard)[]` → `CombatantModel[]`
   - Line 630: `(MercCard | DictatorCard)[]` → `CombatantModel[]`
   - Line 668: `combatant: MercCard | DictatorCard` → `combatant: CombatantModel`
   - Line 789: `combatant: MercCard | DictatorCard` → `combatant: CombatantModel`
   - Line 896: `MercCard | DictatorCard | undefined` → `CombatantModel | undefined`
   - Ensure CombatantModel is imported

2. In src/rules/actions/helpers.ts:
   - Line 268: `unit: MercCard | DictatorCard` → `unit: CombatantModel`
   - Line 277: `unit: MercCard | DictatorCard` → `unit: CombatantModel`
   - CombatantModel should already be imported

3. In src/rules/combat-types.ts:
   - Line 27: `sourceElement: MercCard | DictatorCard | null` → `sourceElement: CombatantModel | null`
   - Add CombatantModel to imports

4. In src/rules/actions/rebel-equipment.ts:
   - Line 265: `MercCard | DictatorCard | undefined` → `CombatantModel | undefined`
   - Line 281: `unit: MercCard | DictatorCard` → `unit: CombatantModel`
   - Line 1351: `(MercCard | DictatorCard)[]` → `CombatantModel[]`
   - Line 1358: `(MercCard | DictatorCard)[]` → `CombatantModel[]`
   - Line 1378: `unit: MercCard | DictatorCard` → `unit: CombatantModel`

5. In src/rules/actions/rebel-economy.ts:
   - Line 597: `MercCard | DictatorCard | null` → `CombatantModel | null`
  </action>
  <verify>npm run build passes, npm test passes</verify>
  <done>All inline unions replaced with CombatantModel, build and tests pass</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests
- [ ] No grep results for `CombatUnitCard`, `CombatUnit[^C]`, `isCombatUnitCard`
- [ ] grep for `MercCard | DictatorCard` returns significantly fewer results (only where semantically correct)
</verification>

<success_criteria>
- All tasks completed
- All backward-compat aliases removed
- Type annotations simplified to use CombatantModel
- No regressions (build and tests pass)
</success_criteria>

<output>
After completion, create `.planning/phases/26-update-references/26-01-SUMMARY.md`
</output>
