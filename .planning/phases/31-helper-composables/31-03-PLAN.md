---
phase: 31
plan: 03
wave: 3
depends_on: [01, 02]
files_modified:
  - src/ui/components/GameBoard.vue
autonomous: true
---

# Plan 03: Update GameBoard.vue to Use Composables

## Objective

Update GameBoard.vue to import and use the new composables, then remove the extracted function definitions. This is the integration step.

## Tasks

<task id="1">
Add imports at the top of GameBoard.vue script section (after existing imports):

```typescript
import { useGameViewHelpers } from '../composables/useGameViewHelpers';
import { useVictoryCalculations } from '../composables/useVictoryCalculations';
```
</task>

<task id="2">
Initialize composables after props definition (around line 55):

```typescript
// Initialize composables with gameView getter
const {
  normalizeClassName,
  findByClassName,
  findAllByClassName,
  findByRef,
  findElementById,
  getAttr,
  findDictatorCombatant,
  findDictatorCombatantWithParent,
  isMercDead,
} = useGameViewHelpers(() => props.gameView);

const {
  countTacticsCards,
  calculateRebelVictoryPoints,
  calculateDictatorVictoryPoints,
  isGameOver,
  gameWinner,
} = useVictoryCalculations(() => props.gameView);
```
</task>

<task id="3">
Remove extracted function definitions from GameBoard.vue:

**HELP-01 functions to remove (lines ~58-214):**
- `normalizeClassName` function definition
- `findByClassName` function definition
- `findAllByClassName` function definition
- `findDictatorCombatant` function definition
- `findDictatorCombatantWithParent` function definition
- `findByRef` function definition
- `findElementById` function definition
- `getAttr` function definition
- `isMercDead` function definition

**HELP-02 functions to remove (lines ~1186-1318):**
- `countTacticsCards` function definition
- `calculateRebelVictoryPoints` function definition
- `calculateDictatorVictoryPoints` function definition
- `isGameOver` computed definition
- `gameWinner` computed definition

**Also remove the comment block:**
```
// ============================================================================
// GAME OVER DETECTION
// ============================================================================
```
</task>

<task id="4">
Verify all usages still work after removal:

**HELP-01 usages (should continue working via destructured imports):**
- `normalizeClassName` — used in template and other computed
- `findByClassName` — used throughout for DOM traversal
- `findAllByClassName` — used for sector/combatant queries
- `findByRef` — used for element lookup
- `findElementById` — used for action selection
- `getAttr` — used extensively for attribute access
- `findDictatorCombatant` — used for dictator state
- `findDictatorCombatantWithParent` — used for sector lookup
- `isMercDead` — used for MERC status checks

**HELP-02 usages (should continue working via destructured imports):**
- `isGameOver` — used in template (line ~2362)
- `gameWinner` — used in template (lines ~2365, ~2388)
- `calculateRebelVictoryPoints` — used in gameWinner
- `calculateDictatorVictoryPoints` — used in gameWinner
</task>

## Verification

<verify>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Run dev server: `npm run dev`
3. Test in browser:
   - Game loads without console errors
   - Sectors display correctly (uses findAllByClassName)
   - Game over detection works (start game, let tactics run out)
   - Victory display shows correct winner
   - Verify isGameOver/gameWinner update reactively when game state changes
4. Verify GameBoard.vue line count reduced by ~130 lines (from function removal)
</verify>

## Must Haves

- [ ] Both composables imported at top of script
- [ ] Composables initialized with `() => props.gameView` getter
- [ ] All functions destructured from composables
- [ ] Original function definitions removed (9 from HELP-01, 5 from HELP-02)
- [ ] No duplicate function definitions remain
- [ ] TypeScript compiles without errors
- [ ] Game runs without runtime errors
- [ ] findByClassName/findAllByClassName still work for sectors
- [ ] isGameOver/gameWinner reactive and display correctly
