---
phase: 18-data-consistency
plan: 01
type: execute
---

<objective>
Add sex field to dictators and verify team limit formula works correctly.

Purpose: Ensure data consistency between MERCs and dictators, validate game balance mechanics
Output: Updated combatants.json with consistent sex field, verified team limit tests
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (hiring unification):
@.planning/phases/17-hiring-unification/17-01-SUMMARY.md

# Relevant source files:
@data/combatants.json
@src/rules/constants.ts
@src/rules/game.ts

**Tech stack available:** TypeScript, Vitest
**Established patterns:** Data files use consistent field structure
**Constraining decisions:**
- Phase 12: Merged mercs.json and dictators.json into combatants.json with cardType discriminator
- sex field marked as optional ("F" for female, absent for male)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sex field to dictators in combatants.json</name>
  <files>data/combatants.json</files>
  <action>Add `"sex": "M"` field to both dictator entries (Castro and Kim) for consistency with MERC data. Place the field after "image" to match the pattern used by female MERCs. This makes the data explicit rather than relying on "absent = male" convention.</action>
  <verify>grep -c '"sex": "M"' data/combatants.json returns 2 (one for each dictator)</verify>
  <done>Both Castro and Kim have "sex": "M" field in combatants.json</done>
</task>

<task type="auto">
  <name>Task 2: Add test verifying team limit formula</name>
  <files>src/rules/__tests__/team-limit.test.ts</files>
  <action>Create a test file that verifies the team limit formula: BASE_TEAM_LIMIT (1) + controlled sectors. Test cases:
1. Player with 0 controlled sectors has team limit of 1
2. Player with 2 controlled sectors has team limit of 3
3. Teresa doesn't count toward team size (teamSize excludes Teresa)
4. Dictator has no team limit (returns Infinity)

Use existing test patterns from src/rules/__tests__/. Import RebelPlayer/DictatorPlayer from game.ts, TeamConstants from constants.ts. Mock game.getControlledSectors() to return test sector counts.</action>
  <verify>npm test src/rules/__tests__/team-limit.test.ts passes all 4 test cases</verify>
  <done>team-limit.test.ts exists with passing tests for all team limit scenarios</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `grep '"sex": "M"' data/combatants.json` shows 2 entries
- [ ] `npm run build` succeeds without errors
- [ ] `npm test src/rules/__tests__/team-limit.test.ts` passes
- [ ] All existing tests still pass
</verification>

<success_criteria>

- Both dictators have explicit sex field
- Team limit formula verified by tests
- No regressions introduced
</success_criteria>

<output>
After completion, create `.planning/phases/18-data-consistency/18-01-SUMMARY.md`
</output>
