---
phase: 20-model-renaming
plan: 03
type: execute
---

<objective>
Update remaining files (AI helpers, flow, day-one) and test files to use new class names.

Purpose: Complete the model renaming across all TypeScript files in the codebase.

Output: All TypeScript files use CombatantBase/CombatantModel, tests updated.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-model-renaming/20-02-SUMMARY.md

**Depends on:** Plan 20-02 (rules layer updated)

**Remaining files:**
- src/rules/ai-helpers.ts
- src/rules/ai-executor.ts
- src/rules/ai-combat-helpers.ts
- src/rules/ai-action-helpers.ts
- src/rules/flow.ts
- src/rules/day-one.ts
- src/rules/combat-retreat.ts
- src/rules/dictator-abilities.ts
- src/rules/tactics-effects.ts

**Test files:**
- tests/*.test.ts files that import these classes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update AI helper files</name>
  <files>src/rules/ai-helpers.ts, src/rules/ai-executor.ts, src/rules/ai-combat-helpers.ts, src/rules/ai-action-helpers.ts</files>
  <action>
    Update imports and type annotations in AI files:
    1. ai-helpers.ts: Change CombatUnit → CombatantBase in type annotations
    2. ai-executor.ts: Update imports
    3. ai-combat-helpers.ts: Update type annotations
    4. ai-action-helpers.ts: Update type annotations

    Keep MercCard/DictatorCard where used for specific queries.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>All AI helper files use CombatantBase/CombatantModel</done>
</task>

<task type="auto">
  <name>Task 2: Update remaining rules files</name>
  <files>src/rules/flow.ts, src/rules/day-one.ts, src/rules/combat-retreat.ts, src/rules/dictator-abilities.ts, src/rules/tactics-effects.ts</files>
  <action>
    Update imports and type annotations:
    1. flow.ts: Update any CombatUnit/CombatUnitCard references
    2. day-one.ts: Update imports and type annotations
    3. combat-retreat.ts: Update type annotations
    4. dictator-abilities.ts: Update imports
    5. tactics-effects.ts: Update imports

    These files likely have fewer references - mainly imports and occasional type annotations.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>All remaining rules files use CombatantBase/CombatantModel</done>
</task>

<task type="auto">
  <name>Task 3: Update test files</name>
  <files>tests/action-conditions.test.ts, tests/combat-execution.test.ts, tests/combat-retreat.test.ts, tests/equipment-effects.test.ts, tests/game.test.ts, tests/merc-abilities.test.ts, tests/merc-abilities-integration.test.ts, tests/smoke.test.ts, tests/state-persistence.test.ts</files>
  <action>
    Update imports in test files:
    1. Change `import { CombatUnit }` → `import { CombatantBase }`
    2. Change `import { CombatUnitCard }` → `import { CombatantModel }`
    3. Update any type annotations in test helpers

    Most tests use MercCard/DictatorCard directly for creating test fixtures, so those imports stay.
    The backward-compat exports ensure tests still work even without changes, but update for consistency.
  </action>
  <verify>`npm test` passes</verify>
  <done>All test files use updated imports</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] `npm test` passes (all existing tests work)
- [ ] No remaining references to CombatUnitCard except in re-export aliases
- [ ] No remaining references to CombatUnit except in re-export aliases
</verification>

<success_criteria>
- All TypeScript files use CombatantBase/CombatantModel
- All tests pass
- Phase 20 complete - model renaming done
</success_criteria>

<output>
After completion, create `.planning/phases/20-model-renaming/20-03-SUMMARY.md`

Include in summary:
- Total files updated
- Any issues encountered
- Ready for Phase 21 (Vue component renaming)
</output>
