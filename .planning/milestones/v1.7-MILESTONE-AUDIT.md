# v1.7 Milestone Audit: GameBoard Component Refactor

**Audited:** 2026-01-19
**Status:** ⚠️ GAPS FOUND

## Scores

| Category | Score | Status |
|----------|-------|--------|
| Requirements | 11/13 | Partial |
| Phases | 6/6 | Complete |
| Integration | 6/6 composables, 4/4 components | Complete |
| Tests | 524/525 | Pass |

## Critical Gaps

### INT-03: All existing functionality preserved (no regressions)

**Status: PARTIAL - Interactive flows broken**

While all 524 tests pass, manual testing revealed broken UI flows:

1. **Landing Zone Selection** - Fixed during audit
   - Issue: Choice matching used `c.value || c.display` but value is element ID (140), not sector name
   - Fix: Changed to match on `c.display` (sector name), pass `c.value` (element ID) to fill()

2. **Hiring Phase Auto-Start** - Fixed during audit
   - Issue: Watcher only watched `availableActions`, not `currentAction`
   - Fix: Watch both - when currentAction becomes null, watcher fires to start next action

3. **Hiring Phase Progression** - Under investigation
   - Issue: After selecting merc, UI may not advance correctly to equipment selection
   - Status: Debug logging added, awaiting user verification

### INT-02: GameBoard.vue reduced to orchestrator role (<500 lines target)

**Status: PARTIAL - 1,428 lines (above 500 target)**

GameBoard.vue has been significantly reduced from ~3,368 lines but is still at 1,428 lines. The component IS functioning as an orchestrator (composing 6 composables and 4 components), but the line count target was not achieved.

**Remaining code in GameBoard:**
- Props definition: 60 lines
- Composable initialization: 220 lines
- Computed properties (not yet extracted): 450 lines
- Watch/action handlers: 350 lines
- Template: 330 lines

## Completed Requirements

| Requirement | Phase | Status |
|-------------|-------|--------|
| HELP-01: useGameViewHelpers | 31 | ✓ Complete |
| HELP-02: useVictoryCalculations | 31 | ✓ Complete |
| STATE-01: usePlayerState | 32 | ✓ Complete |
| STATE-02: useSectorState | 32 | ✓ Complete |
| STATE-03: useSquadState | 32 | ✓ Complete |
| STATE-04: useActionState | 32 | ✓ Complete |
| UI-01: HiringPhase | 35 | ✓ Complete |
| UI-02: HagnessDrawEquipment | 34 | ✓ Complete |
| UI-03: LandingZoneSelection | 33 | ✓ Complete |
| UI-04: GameOverOverlay | 33 | ✓ Complete |
| INT-01: Uses all composables/components | 36 | ✓ Complete |
| INT-02: Orchestrator role (<500 lines) | 36 | ⚠️ Partial (1,428 lines) |
| INT-03: No regressions | 36 | ⚠️ Partial (UI flows broken) |

## Tech Debt

### Phase 35-36: Hiring Phase Integration

1. **selectedMercForEquipment lookup fails during hiring**
   - Warning: `Could not find MERC in game tree: "Ewok"`
   - Cause: Merc is still in deck, not yet in game tree
   - Impact: Low - fallback to JSON data exists
   - Status: Deferred (non-blocking)

2. **Debug logging in production code**
   - `[DEBUG-WATCHER]` and `[DEBUG-CLICK]` console.log statements
   - Added during debugging session
   - Status: Should be removed before release

### Phase 36: TypeScript

1. **Pre-existing type errors with vendor packages**
   - `UseActionControllerReturn` type mismatch
   - Component prop type mismatches
   - Cause: External @boardsmith package types
   - Status: Deferred (infrastructure issue)

2. **Vendor tarballs missing dist folders**
   - Build and some tests blocked
   - Workaround: Run tests that don't require @boardsmith/testing
   - Status: Deferred (packaging issue)

## Verification Results

### Test Suite
```
Test Files:  13 passed (13)
Tests:       524 passed | 1 skipped (525)
Duration:    1.06s
```

### Composable Integration
| Composable | Imported | Destructured | Used |
|------------|----------|--------------|------|
| useGameViewHelpers | ✓ | ✓ | ✓ |
| useVictoryCalculations | ✓ | ✓ | ✓ |
| usePlayerState | ✓ | ✓ | ✓ |
| useSectorState | ✓ | ✓ | ✓ |
| useSquadState | ✓ | ✓ | ✓ |
| useActionState | ✓ | ✓ | ✓ |

### Component Integration
| Component | Imported | Props Wired | Events Wired |
|-----------|----------|-------------|--------------|
| GameOverOverlay | ✓ | ✓ | N/A |
| LandingZoneSelection | ✓ | ✓ | ✓ |
| HagnessDrawEquipment | ✓ | ✓ | ✓ |
| HiringPhase | ✓ | ✓ | ✓ |

### Interactive Flows (Manual Testing Required)
- [ ] Landing zone selection → advances to hiring
- [ ] First merc selection → advances to equipment
- [ ] Equipment selection → advances to second merc
- [ ] Second merc selection → continues
- [ ] Third merc selection (with skip) → advances to next phase
- [ ] Hagness draw equipment flow
- [ ] Combat and retreat flow
- [ ] Game over overlay

## Recommendations

### Before Completing Milestone

1. **Verify hiring flow end-to-end** - Manual testing needed to confirm fixes work
2. **Remove debug logging** - Clean up console.log statements added during debugging
3. **Document line count target** - Either accept 1,428 lines or plan further extraction

### Deferred to Future

1. Extract remaining computed properties from GameBoard.vue
2. Address vendor tarball packaging
3. Fix TypeScript type mismatches with external packages

---

*Audit completed: 2026-01-19*
