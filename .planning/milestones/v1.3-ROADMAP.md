# Milestone v1.3: Combatant Unification

**Status:** ✅ SHIPPED 2026-01-13
**Phases:** 14-19
**Total Plans:** 6

## Overview

Unify dictator and merc combatant handling, fixing bugs and standardizing code patterns. This milestone eliminated inconsistencies between how dictators and mercs were handled across the codebase.

## Phases

### Phase 14: Image Path Fixes

**Goal**: Fix hardcoded `.jpg` in MercIconSmall, MercCard, DictatorPanel, SectorPanel
**Depends on**: Phase 12 (combatants.json merge)
**Plans**: 1 plan

Plans:
- [x] 14-01: Fix image path detection for dictator vs merc

**Details:**
Fixed hardcoded `.jpg` extensions to use `.png` for dictator images. Established pattern: check dictatorId before mercId to detect combatant type.

### Phase 15: Rename to Combatant

**Goal**: MercIcon → CombatantIcon, MercIconSmall → CombatantIconSmall, remove isDictator from equipment UI
**Depends on**: Phase 14
**Plans**: 1 plan

Plans:
- [x] 15-01: Rename icon components and update all consumers

**Details:**
Created unified CombatantIcon and CombatantIconSmall components with auto-detect dictator via mercId prefix. Updated all consumers (SectorTile, DictatorPanel, SectorPanel, GameBoard, MercCard, DrawEquipmentType, CombatPanel).

### Phase 16: Abilities for Controller

**Goal**: Make docHeal, feedbackDiscard, squidheadDisarm/Arm, hagnessDraw available to whoever controls the merc
**Depends on**: Phase 15
**Plans**: 1 plan

Plans:
- [x] 16-01: Enable MERC abilities for any controller

**Details:**
MERC special abilities now work for any controller. Dictator can use Doc heal, Feedback discard, Squidhead mine handling, and Hagness equipment draw. Used OR check (isRebelPlayer OR isDictatorPlayer) pattern.

### Phase 17: Hiring Unification

**Goal**: Apply Apeiron/Vrbansk to dictator hires, Castro human equipment, extract shared function
**Depends on**: Phase 16
**Plans**: 1 plan

Plans:
- [x] 17-01: Unify hire paths with shared helper

**Details:**
Extracted shared equipNewHire helper function that handles both Apeiron grenade/mortar redraw and Vrbansk free accessory logic. Applied to all 4 hire paths (rebel draft, rebel pickup, dictator draft, dictator pickup).

### Phase 18: Data Consistency

**Goal**: Add sex field to dictators (male), verify team limit is 1 + controlled sectors
**Depends on**: Phase 12
**Plans**: 1 plan

Plans:
- [x] 18-01: Add sex field and team limit tests

**Details:**
Added explicit sex field to all dictator entries in combatants.json. Created comprehensive team limit formula tests verifying 1 + controlled sectors calculation.

### Phase 19: Victory/Defeat Fixes

**Goal**: Fix dictator defeat (dead OR rebels control base), rebel defeat (no units after day 1)
**Depends on**: Phase 18
**Plans**: 1 plan

Plans:
- [x] 19-01: Unify isDefeated property

**Details:**
Updated isDefeated getter to return true for dictator dead OR base captured. Simplified isFinished() by removing redundant check. Created comprehensive victory/defeat condition tests (13 tests covering dictator death, base capture, rebel elimination, Day 1 guard).

---

## Milestone Summary

**Key Decisions:**
- Check dictatorId before mercId to detect combatant type
- Auto-detect dictator via mercId prefix rather than explicit prop
- Use OR check (isRebelPlayer OR isDictatorPlayer) for ability actions
- Extracted equipNewHire helper to helpers.ts
- isDefeated now includes base capture check

**Issues Resolved:**
- Dictator images showing broken (wrong extension)
- Dictator couldn't use MERC abilities after hiring
- Apeiron/Vrbansk abilities didn't apply to dictator hires
- isDefeated didn't include base capture condition
- Dictator appearing in two squads simultaneously (bug fix after Phase 19)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- Pre-existing test infrastructure issue: dictator.dictator card not populated in test environment (56 test failures)

---

*For current project status, see .planning/ROADMAP.md*
